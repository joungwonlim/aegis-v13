"use strict";(globalThis.webpackChunkdocs_site=globalThis.webpackChunkdocs_site||[]).push([[38],{2947(e,n,r){r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>d,default:()=>u,frontMatter:()=>c,metadata:()=>t,toc:()=>s});const t=JSON.parse('{"id":"guide/backend/execution-layer","title":"Execution Layer","description":"S6 \uc8fc\ubb38 \uc2e4\ud589","source":"@site/docs/guide/backend/execution-layer.md","sourceDirName":"guide/backend","slug":"/guide/backend/execution-layer","permalink":"/aegis-v13/docs/guide/backend/execution-layer","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"sidebar_position":6,"title":"Execution Layer","description":"S6 \uc8fc\ubb38 \uc2e4\ud589"},"sidebar":"guideSidebar","previous":{"title":"Portfolio Layer","permalink":"/aegis-v13/docs/guide/backend/portfolio-layer"},"next":{"title":"Audit Layer","permalink":"/aegis-v13/docs/guide/backend/audit-layer"}}');var o=r(4848),i=r(8453);const c={sidebar_position:6,title:"Execution Layer",description:"S6 \uc8fc\ubb38 \uc2e4\ud589"},d="Execution Layer",a={},s=[{value:"\ucc45\uc784",id:"\ucc45\uc784",level:2},{value:"\ud3f4\ub354 \uad6c\uc870",id:"\ud3f4\ub354-\uad6c\uc870",level:2},{value:"Execution Planner",id:"execution-planner",level:2},{value:"\uc778\ud130\ud398\uc774\uc2a4",id:"\uc778\ud130\ud398\uc774\uc2a4",level:3},{value:"\uad6c\ud604",id:"\uad6c\ud604",level:3},{value:"Broker Interface",id:"broker-interface",level:2},{value:"KIS Broker \uad6c\ud604",id:"kis-broker-\uad6c\ud604",level:2},{value:"\uc8fc\ubb38 \ubd84\ud560",id:"\uc8fc\ubb38-\ubd84\ud560",level:2},{value:"\uc124\uc815 \uc608\uc2dc (YAML)",id:"\uc124\uc815-\uc608\uc2dc-yaml",level:2},{value:"DB \uc2a4\ud0a4\ub9c8",id:"db-\uc2a4\ud0a4\ub9c8",level:2}];function l(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",p:"p",pre:"pre",strong:"strong",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"execution-layer",children:"Execution Layer"})}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"S6: \uc8fc\ubb38 \uc2e4\ud589"}),"\n"]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"\ucc45\uc784",children:"\ucc45\uc784"}),"\n",(0,o.jsx)(n.p,{children:"\ubaa9\ud45c \ud3ec\ud2b8\ud3f4\ub9ac\uc624\ub97c \uc2e4\uc81c \uc8fc\ubb38\uc73c\ub85c \ubcc0\ud658\ud558\uace0 \uccb4\uacb0 \uad00\ub9ac"}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"\ud3f4\ub354-\uad6c\uc870",children:"\ud3f4\ub354 \uad6c\uc870"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"internal/execution/\n\u251c\u2500\u2500 planner.go      # ExecutionPlanner \uad6c\ud604\n\u251c\u2500\u2500 broker.go       # \uc99d\uad8c\uc0ac \uc5f0\ub3d9 (KIS)\n\u2514\u2500\u2500 monitor.go      # \uccb4\uacb0 \ubaa8\ub2c8\ud130\ub9c1\n"})}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"execution-planner",children:"Execution Planner"}),"\n",(0,o.jsx)(n.h3,{id:"\uc778\ud130\ud398\uc774\uc2a4",children:"\uc778\ud130\ud398\uc774\uc2a4"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:"type ExecutionPlanner interface {\n    Plan(ctx context.Context, target *TargetPortfolio) ([]Order, error)\n}\n"})}),"\n",(0,o.jsx)(n.h3,{id:"\uad6c\ud604",children:"\uad6c\ud604"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:'// internal/execution/planner.go\n\ntype planner struct {\n    broker Broker\n    config ExecutionConfig\n}\n\ntype ExecutionConfig struct {\n    OrderType      string  `yaml:"order_type"`       // "LIMIT", "MARKET"\n    SlippageBps    int     `yaml:"slippage_bps"`     // \uc2ac\ub9ac\ud53c\uc9c0 (10 = 0.1%)\n    MaxOrderSize   int64   `yaml:"max_order_size"`   // \ucd5c\ub300 \uc8fc\ubb38 \uae08\uc561\n    SplitThreshold int64   `yaml:"split_threshold"`  // \ubd84\ud560 \uc8fc\ubb38 \uae30\uc900\n}\n\nfunc (p *planner) Plan(ctx context.Context, target *contracts.TargetPortfolio) ([]contracts.Order, error) {\n    orders := make([]contracts.Order, 0)\n\n    // 1. \ub9e4\ub3c4 \uc8fc\ubb38 \uba3c\uc800 (\uc790\uae08 \ud655\ubcf4)\n    for _, pos := range target.Positions {\n        if pos.Action == contracts.ActionSell {\n            order := p.createSellOrder(pos)\n            orders = append(orders, order)\n        }\n    }\n\n    // 2. \ub9e4\uc218 \uc8fc\ubb38\n    for _, pos := range target.Positions {\n        if pos.Action == contracts.ActionBuy {\n            order := p.createBuyOrder(pos)\n            orders = append(orders, order)\n        }\n    }\n\n    return orders, nil\n}\n\nfunc (p *planner) createBuyOrder(pos contracts.TargetPosition) contracts.Order {\n    price := p.getTargetPrice(pos.Code, "BUY")\n\n    return contracts.Order{\n        Code:      pos.Code,\n        Side:      "BUY",\n        Quantity:  pos.TargetQty,\n        Price:     price,\n        OrderType: p.config.OrderType,\n        Status:    "PENDING",\n    }\n}\n\nfunc (p *planner) getTargetPrice(code string, side string) int {\n    currentPrice := p.broker.GetCurrentPrice(code)\n\n    if p.config.OrderType == "MARKET" {\n        return 0 // \uc2dc\uc7a5\uac00\n    }\n\n    // \uc9c0\uc815\uac00: \uc2ac\ub9ac\ud53c\uc9c0 \uc801\uc6a9\n    slippage := float64(p.config.SlippageBps) / 10000\n\n    if side == "BUY" {\n        return int(float64(currentPrice) * (1 + slippage))\n    }\n    return int(float64(currentPrice) * (1 - slippage))\n}\n'})}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"broker-interface",children:"Broker Interface"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:"// internal/execution/broker.go\n\ntype Broker interface {\n    // \ud604\uc7ac\uac00 \uc870\ud68c\n    GetCurrentPrice(code string) int\n\n    // \uc8fc\ubb38 \uc81c\ucd9c\n    SubmitOrder(ctx context.Context, order *Order) (*OrderResult, error)\n\n    // \uc8fc\ubb38 \ucde8\uc18c\n    CancelOrder(ctx context.Context, orderID string) error\n\n    // \uc8fc\ubb38 \uc0c1\ud0dc \uc870\ud68c\n    GetOrderStatus(ctx context.Context, orderID string) (*OrderStatus, error)\n\n    // \uc794\uace0 \uc870\ud68c\n    GetBalance(ctx context.Context) (*Balance, error)\n}\n"})}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"kis-broker-\uad6c\ud604",children:"KIS Broker \uad6c\ud604"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:'// internal/external/kis/broker.go\n\ntype kisBroker struct {\n    client  *KISClient\n    account string\n}\n\nfunc (b *kisBroker) SubmitOrder(ctx context.Context, order *contracts.Order) (*contracts.OrderResult, error) {\n    // KIS API \ud638\ucd9c\n    req := &KISOrderRequest{\n        AccountNo: b.account,\n        StockCode: order.Code,\n        OrderQty:  order.Quantity,\n        OrderPrice: order.Price,\n        OrderType: b.convertOrderType(order.OrderType),\n        Side:      b.convertSide(order.Side),\n    }\n\n    resp, err := b.client.PlaceOrder(ctx, req)\n    if err != nil {\n        return nil, fmt.Errorf("KIS order failed: %w", err)\n    }\n\n    return &contracts.OrderResult{\n        OrderID:   resp.OrderNo,\n        Status:    "SUBMITTED",\n        Timestamp: time.Now(),\n    }, nil\n}\n'})}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"\uc8fc\ubb38-\ubd84\ud560",children:"\uc8fc\ubb38 \ubd84\ud560"}),"\n",(0,o.jsx)(n.p,{children:"\ub300\ub7c9 \uc8fc\ubb38 \uc2dc \ubd84\ud560 \ucc98\ub9ac:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:"func (p *planner) splitOrder(order contracts.Order) []contracts.Order {\n    if order.Quantity * order.Price < p.config.SplitThreshold {\n        return []contracts.Order{order}\n    }\n\n    // \ubd84\ud560\n    chunks := make([]contracts.Order, 0)\n    remaining := order.Quantity\n    chunkSize := p.config.MaxOrderSize / order.Price\n\n    for remaining > 0 {\n        qty := min(remaining, chunkSize)\n        chunk := order\n        chunk.Quantity = qty\n        chunks = append(chunks, chunk)\n        remaining -= qty\n    }\n\n    return chunks\n}\n"})}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"\uc124\uc815-\uc608\uc2dc-yaml",children:"\uc124\uc815 \uc608\uc2dc (YAML)"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:'# config/execution.yaml\n\nexecution:\n  order_type: "LIMIT"        # LIMIT, MARKET\n  slippage_bps: 10           # 0.1%\n  max_order_size: 50000000   # 5\ucc9c\ub9cc\uc6d0\n  split_threshold: 100000000 # 1\uc5b5\uc6d0 \uc774\uc0c1 \ubd84\ud560\n\n  # \uc8fc\ubb38 \uc2dc\uac04\n  order_time:\n    start: "09:00"\n    end: "15:20"\n\n  # \uc7ac\uc2dc\ub3c4\n  retry:\n    max_attempts: 3\n    delay_seconds: 5\n'})}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"db-\uc2a4\ud0a4\ub9c8",children:"DB \uc2a4\ud0a4\ub9c8"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sql",children:"-- execution.orders: \uc8fc\ubb38 \ub0b4\uc5ed\nCREATE TABLE execution.orders (\n    id           SERIAL PRIMARY KEY,\n    order_id     VARCHAR(50) UNIQUE,  -- \uc99d\uad8c\uc0ac \uc8fc\ubb38\ubc88\ud638\n    code         VARCHAR(10) NOT NULL,\n    side         VARCHAR(4) NOT NULL,  -- BUY, SELL\n    quantity     INT NOT NULL,\n    price        INT,\n    order_type   VARCHAR(10),          -- LIMIT, MARKET\n    status       VARCHAR(20),          -- PENDING, FILLED, PARTIAL, REJECTED\n    filled_qty   INT DEFAULT 0,\n    filled_price INT,\n    reason       TEXT,\n    created_at   TIMESTAMPTZ DEFAULT NOW(),\n    updated_at   TIMESTAMPTZ DEFAULT NOW()\n);\n\n-- execution.executions: \uccb4\uacb0 \ub0b4\uc5ed\nCREATE TABLE execution.executions (\n    id          SERIAL PRIMARY KEY,\n    order_id    VARCHAR(50) REFERENCES execution.orders(order_id),\n    exec_qty    INT NOT NULL,\n    exec_price  INT NOT NULL,\n    exec_time   TIMESTAMPTZ NOT NULL,\n    fee         DECIMAL(12,2),\n    created_at  TIMESTAMPTZ DEFAULT NOW()\n);\n\nCREATE INDEX idx_orders_status ON execution.orders(status);\nCREATE INDEX idx_orders_date ON execution.orders(created_at);\n"})}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Prev"}),": ",(0,o.jsx)(n.a,{href:"/aegis-v13/docs/guide/backend/portfolio-layer",children:"Portfolio Layer"}),"\n",(0,o.jsx)(n.strong,{children:"Next"}),": ",(0,o.jsx)(n.a,{href:"/aegis-v13/docs/guide/backend/audit-layer",children:"Audit Layer"})]})]})}function u(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}},8453(e,n,r){r.d(n,{R:()=>c,x:()=>d});var t=r(6540);const o={},i=t.createContext(o);function c(e){const n=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:c(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);