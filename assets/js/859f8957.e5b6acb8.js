"use strict";(globalThis.webpackChunkdocs_site=globalThis.webpackChunkdocs_site||[]).push([[9038],{2947(e,n,r){r.r(n),r.d(n,{assets:()=>s,contentTitle:()=>o,default:()=>x,frontMatter:()=>d,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"guide/backend/execution-layer","title":"Execution Layer","description":"S6 \uc8fc\ubb38 \uc2e4\ud589","source":"@site/docs/guide/backend/execution-layer.md","sourceDirName":"guide/backend","slug":"/guide/backend/execution-layer","permalink":"/aegis-v13/docs/guide/backend/execution-layer","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"sidebar_position":6,"title":"Execution Layer","description":"S6 \uc8fc\ubb38 \uc2e4\ud589"},"sidebar":"guideSidebar","previous":{"title":"Portfolio Layer","permalink":"/aegis-v13/docs/guide/backend/portfolio-layer"},"next":{"title":"Audit Layer","permalink":"/aegis-v13/docs/guide/backend/audit-layer"}}');var i=r(4848),c=r(8453);const d={sidebar_position:6,title:"Execution Layer",description:"S6 \uc8fc\ubb38 \uc2e4\ud589"},o="Execution Layer",s={},l=[{value:"\ucc45\uc784",id:"\ucc45\uc784",level:2},{value:"\uad6c\ud604 \uc0c1\ud0dc (2026-01-11)",id:"\uad6c\ud604-\uc0c1\ud0dc-2026-01-11",level:2},{value:"\ub9ac\uc2a4\ud06c \uac8c\uc774\ud2b8 (Phase B)",id:"\ub9ac\uc2a4\ud06c-\uac8c\uc774\ud2b8-phase-b",level:3},{value:"\ud504\ub85c\uc138\uc2a4 \ud750\ub984",id:"\ud504\ub85c\uc138\uc2a4-\ud750\ub984",level:2},{value:"\ud3f4\ub354 \uad6c\uc870",id:"\ud3f4\ub354-\uad6c\uc870",level:2},{value:"Execution Planner",id:"execution-planner",level:2},{value:"\uc778\ud130\ud398\uc774\uc2a4",id:"\uc778\ud130\ud398\uc774\uc2a4",level:3},{value:"\uad6c\ud604",id:"\uad6c\ud604",level:3},{value:"Broker Interface",id:"broker-interface",level:2},{value:"KIS Broker \uad6c\ud604",id:"kis-broker-\uad6c\ud604",level:2},{value:"\uc8fc\ubb38 \ubd84\ud560",id:"\uc8fc\ubb38-\ubd84\ud560",level:2},{value:"\uc124\uc815 \uc608\uc2dc (YAML)",id:"\uc124\uc815-\uc608\uc2dc-yaml",level:2},{value:"DB \uc2a4\ud0a4\ub9c8",id:"db-\uc2a4\ud0a4\ub9c8",level:2}];function a(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,c.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"execution-layer",children:"Execution Layer"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"S6: \uc8fc\ubb38 \uc2e4\ud589"}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"\ucc45\uc784",children:"\ucc45\uc784"}),"\n",(0,i.jsx)(n.p,{children:"\ubaa9\ud45c \ud3ec\ud2b8\ud3f4\ub9ac\uc624\ub97c \uc2e4\uc81c \uc8fc\ubb38\uc73c\ub85c \ubcc0\ud658\ud558\uace0 \uccb4\uacb0 \uad00\ub9ac"}),"\n",(0,i.jsxs)(n.admonition,{title:"\u2b50 P0 \ud575\uc2ec \ucc45\uc784: \uc218\ub7c9 \uacc4\uc0b0",type:"tip",children:[(0,i.jsxs)(n.p,{children:["Portfolio(S5)\ub294 **\ubaa9\ud45c \uae08\uc561(TargetValue)**\ub9cc \uc0b0\ucd9c\ud569\ub2c8\ub2e4.\nExecution(S6)\uc740 ",(0,i.jsx)(n.strong,{children:"\ud604\uc7ac\uac00\ub97c \uc870\ud68c\ud558\uc5ec \uc218\ub7c9(Qty)\uc744 \uacc4\uc0b0"}),"\ud569\ub2c8\ub2e4."]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Qty = TargetValue / CurrentPrice\n"})}),(0,i.jsx)(n.p,{children:"\uc774\ub807\uac8c \ubd84\ub9ac\ud558\ub294 \uc774\uc720:"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Portfolio\ub294 \uac00\uaca9 \ubcc0\ub3d9\uc5d0 \ub3c5\ub9bd\uc801"}),"\n",(0,i.jsx)(n.li,{children:"\uc2e4\uc81c \uc8fc\ubb38 \uc2dc\uc810\uc758 \ud604\uc7ac\uac00\ub85c \uc815\ud655\ud55c \uc218\ub7c9 \uacc4\uc0b0"}),"\n",(0,i.jsx)(n.li,{children:"\uc7ac\ud604\uc131: \uac19\uc740 TargetValue\ub85c \uc5b8\uc81c\ub4e0 \uc218\ub7c9 \uc7ac\uacc4\uc0b0 \uac00\ub2a5"}),"\n"]})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"\uad6c\ud604-\uc0c1\ud0dc-2026-01-11",children:"\uad6c\ud604 \uc0c1\ud0dc (2026-01-11)"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"\ucef4\ud3ec\ub10c\ud2b8"}),(0,i.jsx)(n.th,{children:"\uc0c1\ud0dc"}),(0,i.jsx)(n.th,{children:"\ud30c\uc77c"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"ExecutionPlanner"})}),(0,i.jsx)(n.td,{children:"\u2705 \uc644\ub8cc"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"internal/execution/planner.go"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Broker Interface"})}),(0,i.jsx)(n.td,{children:"\u2705 \uc644\ub8cc"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"internal/execution/broker.go"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"ExecutionMonitor"})}),(0,i.jsx)(n.td,{children:"\u2705 \uc644\ub8cc"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"internal/execution/monitor.go"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Repository"})}),(0,i.jsx)(n.td,{children:"\u2705 \uc644\ub8cc"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"internal/execution/repository.go"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"RiskGate (Phase B)"})}),(0,i.jsx)(n.td,{children:"\u2705 \uc644\ub8cc"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"internal/execution/risk_gate.go"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"KIS API \uc5f0\ub3d9"}),(0,i.jsx)(n.td,{children:"\u23f3 TODO"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"internal/external/kis/"})})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"\ub9ac\uc2a4\ud06c-\uac8c\uc774\ud2b8-phase-b",children:"\ub9ac\uc2a4\ud06c \uac8c\uc774\ud2b8 (Phase B)"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"\ucef4\ud3ec\ub10c\ud2b8"}),(0,i.jsx)(n.th,{children:"\uc0c1\ud0dc"}),(0,i.jsx)(n.th,{children:"\uc124\uba85"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"RiskGate"})}),(0,i.jsx)(n.td,{children:"\u2705 \uc644\ub8cc"}),(0,i.jsx)(n.td,{children:"S6 \uc0ac\uc804 \ub9ac\uc2a4\ud06c \uccb4\ud06c"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Shadow Mode"})}),(0,i.jsx)(n.td,{children:"\u2705 \uc644\ub8cc"}),(0,i.jsx)(n.td,{children:"\ucc28\ub2e8 \ub85c\uae45 (would_block)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Gate CLI"})}),(0,i.jsx)(n.td,{children:"\u2705 \uc644\ub8cc"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"go run ./cmd/quant gate"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"DB Migration"})}),(0,i.jsx)(n.td,{children:"\u2705 \uc644\ub8cc"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"migrations/026_risk_gate_events.sql"})})]})]})]}),"\n",(0,i.jsx)(n.admonition,{title:"YAML SSOT",type:"tip",children:(0,i.jsxs)(n.p,{children:["\uc8fc\ubb38 \uc124\uc815\uacfc \uc2ac\ub9ac\ud53c\uc9c0 \ubaa8\ub378\uc740 ",(0,i.jsx)(n.code,{children:"backend/config/strategy/korea_equity_v13.yaml"}),"\uc758 ",(0,i.jsx)(n.code,{children:"execution"})," \uc139\uc158\uc5d0\uc11c \uad00\ub9ac\ub429\ub2c8\ub2e4."]})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"\ud504\ub85c\uc138\uc2a4-\ud750\ub984",children:"\ud504\ub85c\uc138\uc2a4 \ud750\ub984"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                        Execution Pipeline                                    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                    \u2502\n                                    \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                           \uc785\ub825: TargetPortfolio                              \u2502\n\u2502                        (S5\uc5d0\uc11c \uc0dd\uc131\ub41c \ubaa9\ud45c \ud3ec\ud2b8\ud3f4\ub9ac\uc624)                          \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                    \u2502\n        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n        \u25bc                           \u25bc                           \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510       \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510       \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  1. \uc8fc\ubb38 \uacc4\ud68d     \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502  2. \uc8fc\ubb38 \ubd84\ud560     \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502  3. \uc8fc\ubb38 \uc81c\ucd9c     \u2502\n\u2502   (Planner)       \u2502       \u2502   (Splitting)     \u2502       \u2502   (Broker)        \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524       \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524       \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 \u2022 \ud604\uc7ac \ubcf4\uc720 \uc870\ud68c  \u2502       \u2502 \uc8fc\ubb38/ADTV20 \u2265 2% \u2502       \u2502 \u2022 order_type:     \u2502\n\u2502 \u2022 Diff \uacc4\uc0b0       \u2502       \u2502 \u2192 \ubd84\ud560 \uc2e4\ud589       \u2502       \u2502   LIMIT           \u2502\n\u2502 \u2022 \ub9e4\ub3c4 \uc6b0\uc120 \uc0dd\uc131  \u2502       \u2502 \u2022 min_slices: 3   \u2502       \u2502 \u2022 \ub9e4\uc218: ASK1      \u2502\n\u2502 \u2022 \ub9e4\uc218 \uc8fc\ubb38 \uc0dd\uc131  \u2502       \u2502 \u2022 max_slices: 8   \u2502       \u2502 \u2022 \ub9e4\ub3c4: BID1      \u2502\n\u2502                   \u2502       \u2502 \u2022 interval: 90s   \u2502       \u2502                   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                                                \u2502\n                                                                \u25bc\n                                                \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                                                \u2502  4. \uccb4\uacb0 \ubaa8\ub2c8\ud130\ub9c1          \u2502\n                                                \u2502      (Monitor)            \u2502\n                                                \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n                                                \u2502 \u2022 \uccb4\uacb0 \uc0c1\ud0dc \ucd94\uc801           \u2502\n                                                \u2502 \u2022 \ubbf8\uccb4\uacb0 \uc8fc\ubb38 \ucc98\ub9ac          \u2502\n                                                \u2502 \u2022 \uc2ac\ub9ac\ud53c\uc9c0 \uae30\ub85d            \u2502\n                                                \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"\ud3f4\ub354-\uad6c\uc870",children:"\ud3f4\ub354 \uad6c\uc870"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"internal/execution/\n\u251c\u2500\u2500 planner.go      # ExecutionPlanner \uad6c\ud604 (\uc218\ub7c9 \uacc4\uc0b0\u2b50)\n\u251c\u2500\u2500 broker.go       # \uc99d\uad8c\uc0ac \uc5f0\ub3d9 (KIS)\n\u251c\u2500\u2500 monitor.go      # \uccb4\uacb0 \ubaa8\ub2c8\ud130\ub9c1\n\u251c\u2500\u2500 exit_rules.go   # \uccad\uc0b0 \uaddc\uce59 (\uc190\uc808/\uc775\uc808/\ucd94\uc138)\n\u2514\u2500\u2500 repository.go   # DB \uc811\uadfc (SSOT)\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"execution-planner",children:"Execution Planner"}),"\n",(0,i.jsx)(n.h3,{id:"\uc778\ud130\ud398\uc774\uc2a4",children:"\uc778\ud130\ud398\uc774\uc2a4"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:"type ExecutionPlanner interface {\n    Plan(ctx context.Context, target *TargetPortfolio) ([]Order, error)\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\uad6c\ud604",children:"\uad6c\ud604"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:'// internal/execution/planner.go\n\ntype planner struct {\n    broker Broker\n    config ExecutionConfig\n}\n\ntype ExecutionConfig struct {\n    OrderType      string  `yaml:"order_type"`       // "LIMIT", "MARKET"\n    SlippageBps    int     `yaml:"slippage_bps"`     // \uc2ac\ub9ac\ud53c\uc9c0 (10 = 0.1%)\n    MaxOrderSize   int64   `yaml:"max_order_size"`   // \ucd5c\ub300 \uc8fc\ubb38 \uae08\uc561\n    SplitThreshold int64   `yaml:"split_threshold"`  // \ubd84\ud560 \uc8fc\ubb38 \uae30\uc900\n}\n\nfunc (p *planner) Plan(ctx context.Context, target *contracts.TargetPortfolio) ([]contracts.Order, error) {\n    orders := make([]contracts.Order, 0)\n\n    // 1. \ub9e4\ub3c4 \uc8fc\ubb38 \uba3c\uc800 (\uc790\uae08 \ud655\ubcf4)\n    for _, pos := range target.Positions {\n        if pos.Action == contracts.ActionSell {\n            order, err := p.createSellOrder(ctx, pos)\n            if err != nil {\n                return nil, err\n            }\n            orders = append(orders, order)\n        }\n    }\n\n    // 2. \ub9e4\uc218 \uc8fc\ubb38\n    for _, pos := range target.Positions {\n        if pos.Action == contracts.ActionBuy {\n            order, err := p.createBuyOrder(ctx, pos)\n            if err != nil {\n                return nil, err\n            }\n            orders = append(orders, order)\n        }\n    }\n\n    return orders, nil\n}\n\n// \u2b50 P0 \ud575\uc2ec: TargetValue\ub97c \ud604\uc7ac\uac00\ub85c \ub098\ub220 \uc218\ub7c9 \uacc4\uc0b0\nfunc (p *planner) createBuyOrder(ctx context.Context, pos contracts.TargetPosition) (contracts.Order, error) {\n    // 1. \ud604\uc7ac\uac00 \uc870\ud68c\n    currentPrice, err := p.broker.GetCurrentPrice(ctx, pos.Code)\n    if err != nil {\n        return contracts.Order{}, fmt.Errorf("get price for %s: %w", pos.Code, err)\n    }\n\n    // 2. \uc218\ub7c9 \uacc4\uc0b0: Qty = TargetValue / CurrentPrice\n    qty := pos.CalculateQty(int64(currentPrice))\n    if qty <= 0 {\n        return contracts.Order{}, fmt.Errorf("calculated qty is zero for %s (value=%d, price=%.0f)",\n            pos.Code, pos.TargetValue, currentPrice)\n    }\n\n    // 3. \uc8fc\ubb38\uac00 \uacb0\uc815 (\uc2ac\ub9ac\ud53c\uc9c0 \uc801\uc6a9)\n    price := p.getTargetPrice(currentPrice, "BUY")\n\n    return contracts.Order{\n        Code:      pos.Code,\n        Side:      "BUY",\n        Quantity:  qty,\n        Price:     price,\n        OrderType: p.config.OrderType,\n        Status:    "PENDING",\n    }, nil\n}\n\nfunc (p *planner) getTargetPrice(code string, side string) int {\n    currentPrice := p.broker.GetCurrentPrice(code)\n\n    if p.config.OrderType == "MARKET" {\n        return 0 // \uc2dc\uc7a5\uac00\n    }\n\n    // \uc9c0\uc815\uac00: \uc2ac\ub9ac\ud53c\uc9c0 \uc801\uc6a9\n    slippage := float64(p.config.SlippageBps) / 10000\n\n    if side == "BUY" {\n        return int(float64(currentPrice) * (1 + slippage))\n    }\n    return int(float64(currentPrice) * (1 - slippage))\n}\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"broker-interface",children:"Broker Interface"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:"// internal/execution/broker.go\n\n// \u2b50 P0 \uc218\uc815: \ubaa8\ub4e0 \uba54\uc11c\ub4dc\uc5d0 ctx \ucd94\uac00, \uac00\uaca9\uc740 float64 \ubc18\ud658\ntype Broker interface {\n    // \ud604\uc7ac\uac00 \uc870\ud68c (float64\ub85c \ud1b5\uc77c, \ud638\ucd9c\uc790\uac00 \ud544\uc694\uc2dc int64\ub85c \ubcc0\ud658)\n    GetCurrentPrice(ctx context.Context, code string) (float64, error)\n\n    // \uc8fc\ubb38 \uc81c\ucd9c\n    SubmitOrder(ctx context.Context, order *Order) (*OrderResult, error)\n\n    // \uc8fc\ubb38 \ucde8\uc18c\n    CancelOrder(ctx context.Context, orderID string) error\n\n    // \uc8fc\ubb38 \uc0c1\ud0dc \uc870\ud68c\n    GetOrderStatus(ctx context.Context, orderID string) (*OrderStatus, error)\n\n    // \uc794\uace0 \uc870\ud68c\n    GetBalance(ctx context.Context) (*Balance, error)\n\n    // \ud604\uc7ac \ubcf4\uc720 \uc885\ubaa9 \uc870\ud68c\n    GetHoldings(ctx context.Context) ([]Holding, error)\n}\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"kis-broker-\uad6c\ud604",children:"KIS Broker \uad6c\ud604"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:'// internal/external/kis/broker.go\n\ntype kisBroker struct {\n    client  *KISClient\n    account string\n}\n\nfunc (b *kisBroker) SubmitOrder(ctx context.Context, order *contracts.Order) (*contracts.OrderResult, error) {\n    // KIS API \ud638\ucd9c\n    req := &KISOrderRequest{\n        AccountNo: b.account,\n        StockCode: order.Code,\n        OrderQty:  order.Quantity,\n        OrderPrice: order.Price,\n        OrderType: b.convertOrderType(order.OrderType),\n        Side:      b.convertSide(order.Side),\n    }\n\n    resp, err := b.client.PlaceOrder(ctx, req)\n    if err != nil {\n        return nil, fmt.Errorf("KIS order failed: %w", err)\n    }\n\n    return &contracts.OrderResult{\n        OrderID:   resp.OrderNo,\n        Status:    "SUBMITTED",\n        Timestamp: time.Now(),\n    }, nil\n}\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"\uc8fc\ubb38-\ubd84\ud560",children:"\uc8fc\ubb38 \ubd84\ud560"}),"\n",(0,i.jsx)(n.p,{children:"\ub300\ub7c9 \uc8fc\ubb38 \uc2dc \ubd84\ud560 \ucc98\ub9ac:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:'// \u2b50 P0 \uc218\uc815: Price=0 (\uc2dc\uc7a5\uac00) \ubc29\uc5b4 \ucf54\ub4dc \ucd94\uac00\nfunc (p *planner) splitOrder(order contracts.Order) []contracts.Order {\n    // \ubc29\uc5b4: \uc2dc\uc7a5\uac00 \uc8fc\ubb38(Price=0)\uc740 \ubd84\ud560 \ubd88\uac00\n    if order.Price <= 0 {\n        p.logger.Warn("Cannot split market order (price=0), returning as-is",\n            "code", order.Code)\n        return []contracts.Order{order}\n    }\n\n    if order.Quantity * order.Price < p.config.SplitThreshold {\n        return []contracts.Order{order}\n    }\n\n    // \ubd84\ud560\n    chunks := make([]contracts.Order, 0)\n    remaining := order.Quantity\n    chunkSize := p.config.MaxOrderSize / order.Price\n\n    // \ubc29\uc5b4: chunkSize\uac00 0\uc774\uba74 \ubd84\ud560 \ubd88\uac00\n    if chunkSize <= 0 {\n        p.logger.Warn("ChunkSize is zero, returning order as-is",\n            "code", order.Code, "maxOrderSize", p.config.MaxOrderSize)\n        return []contracts.Order{order}\n    }\n\n    for remaining > 0 {\n        qty := min(remaining, chunkSize)\n        chunk := order\n        chunk.Quantity = qty\n        chunks = append(chunks, chunk)\n        remaining -= qty\n    }\n\n    return chunks\n}\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"\uc124\uc815-\uc608\uc2dc-yaml",children:"\uc124\uc815 \uc608\uc2dc (YAML)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'# config/execution.yaml\n\nexecution:\n  order_type: "LIMIT"        # LIMIT, MARKET\n  slippage_bps: 10           # 0.1%\n  max_order_size: 50000000   # 5\ucc9c\ub9cc\uc6d0\n  split_threshold: 100000000 # 1\uc5b5\uc6d0 \uc774\uc0c1 \ubd84\ud560\n\n  # \uc8fc\ubb38 \uc2dc\uac04\n  order_time:\n    start: "09:00"\n    end: "15:20"\n\n  # \uc7ac\uc2dc\ub3c4\n  retry:\n    max_attempts: 3\n    delay_seconds: 5\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"db-\uc2a4\ud0a4\ub9c8",children:"DB \uc2a4\ud0a4\ub9c8"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"-- execution.orders: \uc8fc\ubb38 \ub0b4\uc5ed\nCREATE TABLE execution.orders (\n    id           SERIAL PRIMARY KEY,\n    order_id     VARCHAR(50) UNIQUE,  -- \uc99d\uad8c\uc0ac \uc8fc\ubb38\ubc88\ud638\n    code         VARCHAR(10) NOT NULL,\n    side         VARCHAR(4) NOT NULL,  -- BUY, SELL\n    quantity     INT NOT NULL,\n    price        INT,\n    order_type   VARCHAR(10),          -- LIMIT, MARKET\n    status       VARCHAR(20),          -- PENDING, FILLED, PARTIAL, REJECTED\n    filled_qty   INT DEFAULT 0,\n    filled_price INT,\n    reason       TEXT,\n    created_at   TIMESTAMPTZ DEFAULT NOW(),\n    updated_at   TIMESTAMPTZ DEFAULT NOW()\n);\n\n-- execution.executions: \uccb4\uacb0 \ub0b4\uc5ed\nCREATE TABLE execution.executions (\n    id          SERIAL PRIMARY KEY,\n    order_id    VARCHAR(50) REFERENCES execution.orders(order_id),\n    exec_qty    INT NOT NULL,\n    exec_price  INT NOT NULL,\n    exec_time   TIMESTAMPTZ NOT NULL,\n    fee         DECIMAL(12,2),\n    created_at  TIMESTAMPTZ DEFAULT NOW()\n);\n\nCREATE INDEX idx_orders_status ON execution.orders(status);\nCREATE INDEX idx_orders_date ON execution.orders(created_at);\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Prev"}),": ",(0,i.jsx)(n.a,{href:"/aegis-v13/docs/guide/backend/portfolio-layer",children:"Portfolio Layer"}),"\n",(0,i.jsx)(n.strong,{children:"Next"}),": ",(0,i.jsx)(n.a,{href:"/aegis-v13/docs/guide/backend/audit-layer",children:"Audit Layer"})]})]})}function x(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},8453(e,n,r){r.d(n,{R:()=>d,x:()=>o});var t=r(6540);const i={},c=t.createContext(i);function d(e){const n=t.useContext(c);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:d(e.components),t.createElement(c.Provider,{value:n},e.children)}}}]);