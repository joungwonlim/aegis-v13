"use strict";(globalThis.webpackChunkdocs_site=globalThis.webpackChunkdocs_site||[]).push([[6347],{8453(e,n,r){r.d(n,{R:()=>t,x:()=>c});var i=r(6540);const d={},s=i.createContext(d);function t(e){const n=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:t(e.components),i.createElement(s.Provider,{value:n},e.children)}},9685(e,n,r){r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>o,frontMatter:()=>t,metadata:()=>i,toc:()=>h});const i=JSON.parse('{"id":"guide/backend/infrastructure","title":"Infrastructure","description":"Redis, Database, HTTP Client \uc124\uc815","source":"@site/docs/guide/backend/infrastructure.md","sourceDirName":"guide/backend","slug":"/guide/backend/infrastructure","permalink":"/aegis-v13/docs/guide/backend/infrastructure","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":8,"frontMatter":{"sidebar_position":8,"title":"Infrastructure","description":"Redis, Database, HTTP Client \uc124\uc815"},"sidebar":"guideSidebar","previous":{"title":"Audit Layer","permalink":"/aegis-v13/docs/guide/backend/audit-layer"},"next":{"title":"Forecast Layer","permalink":"/aegis-v13/docs/guide/backend/forecast-layer"}}');var d=r(4848),s=r(8453);const t={sidebar_position:8,title:"Infrastructure",description:"Redis, Database, HTTP Client \uc124\uc815"},c="Infrastructure",l={},h=[{value:"Overview",id:"overview",level:2},{value:"Redis",id:"redis",level:2},{value:"\uc6a9\ub3c4",id:"\uc6a9\ub3c4",level:3},{value:"\ud30c\uc77c \uad6c\uc870",id:"\ud30c\uc77c-\uad6c\uc870",level:3},{value:"\uc5f0\uacb0 \uc124\uc815",id:"\uc5f0\uacb0-\uc124\uc815",level:3},{value:"\ub808\uc774\ud2b8 \ub9ac\ubbf8\ud130",id:"\ub808\uc774\ud2b8-\ub9ac\ubbf8\ud130",level:3},{value:"\uce90\uc2dc \ud5ec\ud37c",id:"\uce90\uc2dc-\ud5ec\ud37c",level:3},{value:"HTTP \ud074\ub77c\uc774\uc5b8\ud2b8 \ud1b5\ud569",id:"http-\ud074\ub77c\uc774\uc5b8\ud2b8-\ud1b5\ud569",level:3},{value:"\ud658\uacbd\ubcc0\uc218",id:"\ud658\uacbd\ubcc0\uc218",level:2},{value:"\ub85c\uceec \uc124\uc815",id:"\ub85c\uceec-\uc124\uc815",level:2},{value:"\ud14c\uc2a4\ud2b8",id:"\ud14c\uc2a4\ud2b8",level:2},{value:"Scheduler",id:"scheduler",level:2},{value:"Overview",id:"overview-1",level:3},{value:"\ub4f1\ub85d\ub41c \uc791\uc5c5",id:"\ub4f1\ub85d\ub41c-\uc791\uc5c5",level:3},{value:"CLI \uba85\ub839\uc5b4",id:"cli-\uba85\ub839\uc5b4",level:3},{value:"Job \uc778\ud130\ud398\uc774\uc2a4",id:"job-\uc778\ud130\ud398\uc774\uc2a4",level:3},{value:"Cron \uc2a4\ucf00\uc904 \ud615\uc2dd",id:"cron-\uc2a4\ucf00\uc904-\ud615\uc2dd",level:3}];function a(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,s.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(n.header,{children:(0,d.jsx)(n.h1,{id:"infrastructure",children:"Infrastructure"})}),"\n",(0,d.jsxs)(n.blockquote,{children:["\n",(0,d.jsx)(n.p,{children:"\uc778\ud504\ub77c \uacc4\uce35: Redis, Database, HTTP Client"}),"\n"]}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"\ud328\ud0a4\uc9c0"}),(0,d.jsx)(n.th,{children:"\uc5ed\ud560"}),(0,d.jsx)(n.th,{children:"\uc704\uce58"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.strong,{children:"pkg/redis"})}),(0,d.jsx)(n.td,{children:"\uce90\uc2dc, \ub808\uc774\ud2b8 \ub9ac\ubc0b, Pub/Sub"}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"pkg/redis/"})})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.strong,{children:"pkg/database"})}),(0,d.jsx)(n.td,{children:"PostgreSQL \uc5f0\uacb0 \ud480"}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"pkg/database/"})})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.strong,{children:"pkg/httputil"})}),(0,d.jsx)(n.td,{children:"HTTP \ud074\ub77c\uc774\uc5b8\ud2b8 (\uc7ac\uc2dc\ub3c4, \ub85c\uae45)"}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"pkg/httputil/"})})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.strong,{children:"pkg/config"})}),(0,d.jsx)(n.td,{children:"\ud658\uacbd\ubcc0\uc218 \uad00\ub9ac (SSOT)"}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"pkg/config/"})})]})]})]}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"redis",children:"Redis"}),"\n",(0,d.jsx)(n.h3,{id:"\uc6a9\ub3c4",children:"\uc6a9\ub3c4"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"\uae30\ub2a5"}),(0,d.jsx)(n.th,{children:"\uc124\uba85"}),(0,d.jsx)(n.th,{children:"TTL"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.strong,{children:"\ub808\uc774\ud2b8 \ub9ac\ubc0b"})}),(0,d.jsx)(n.td,{children:"\uc678\ubd80 API \ud638\ucd9c \uc81c\ud55c"}),(0,d.jsx)(n.td,{children:"\uc790\ub3d9 \ub9cc\ub8cc"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.strong,{children:"\uce90\uc2dc"})}),(0,d.jsx)(n.td,{children:"\uc2dc\uc138/\uc885\ubaa9\uc815\ubcf4 \uce90\uc2f1"}),(0,d.jsx)(n.td,{children:"1\ubd84 ~ 24\uc2dc\uac04"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.strong,{children:"Pub/Sub"})}),(0,d.jsx)(n.td,{children:"\uc2e4\uc2dc\uac04 \uc2dc\uc138 \ube0c\ub85c\ub4dc\uce90\uc2a4\ud2b8"}),(0,d.jsx)(n.td,{children:"-"})]})]})]}),"\n",(0,d.jsx)(n.h3,{id:"\ud30c\uc77c-\uad6c\uc870",children:"\ud30c\uc77c \uad6c\uc870"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"pkg/redis/\n\u251c\u2500\u2500 client.go      # \uc5f0\uacb0 \uad00\ub9ac\n\u251c\u2500\u2500 ratelimit.go   # \ub808\uc774\ud2b8 \ub9ac\ubbf8\ud130\n\u251c\u2500\u2500 cache.go       # \uce90\uc2dc \ud5ec\ud37c\n\u2514\u2500\u2500 redis_test.go  # \ud14c\uc2a4\ud2b8\n"})}),"\n",(0,d.jsx)(n.h3,{id:"\uc5f0\uacb0-\uc124\uc815",children:"\uc5f0\uacb0 \uc124\uc815"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-go",children:'import "github.com/wonny/aegis/v13/backend/pkg/redis"\n\n// \ud074\ub77c\uc774\uc5b8\ud2b8 \uc0dd\uc131\nclient, err := redis.New(cfg)\nif err != nil {\n    log.Fatal(err)\n}\ndefer client.Close()\n\n// Redis \ube44\ud65c\uc131\ud654 \uc2dc graceful fallback\nif !client.Enabled() {\n    // \ubaa8\ub4e0 \uae30\ub2a5\uc774 no-op\uc73c\ub85c \ub3d9\uc791\n}\n'})}),"\n",(0,d.jsx)(n.h3,{id:"\ub808\uc774\ud2b8-\ub9ac\ubbf8\ud130",children:"\ub808\uc774\ud2b8 \ub9ac\ubbf8\ud130"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-go",children:'// \uc0dd\uc131\nlimiter := redis.NewRateLimiter(client, "aegis")\n\n// \uc0ac\uc804 \uc815\uc758\ub41c \uc124\uc815\nredis.KISRateLimit   // 5 req/sec (\ud55c\uad6d\ud22c\uc790\uc99d\uad8c)\nredis.DARTRateLimit  // 100 req/min (\uc804\uc790\uacf5\uc2dc)\nredis.NaverRateLimit // 10 req/sec (\ub124\uc774\ubc84 \uae08\uc735)\n\n// \uc0ac\uc6a9\nallowed, remaining, err := limiter.Allow(ctx, redis.KISRateLimit)\nif !allowed {\n    // \uc694\uccad \uac70\ubd80 \ub610\ub294 \ub300\uae30\n}\n\n// \ube14\ub85c\ud0b9 \ub300\uae30 (\ud5c8\uc6a9\ub420 \ub54c\uae4c\uc9c0)\nerr := limiter.Wait(ctx, redis.KISRateLimit)\n'})}),"\n",(0,d.jsx)(n.h3,{id:"\uce90\uc2dc-\ud5ec\ud37c",children:"\uce90\uc2dc \ud5ec\ud37c"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-go",children:'cache := redis.NewCache(client, "aegis")\n\n// \uae30\ubcf8 \uc0ac\uc6a9\nvar stock StockInfo\nfound, err := cache.Get(ctx, "stock:005930", &stock)\n\n// TTL\uacfc \ud568\uaed8 \uc800\uc7a5\nerr := cache.Set(ctx, "stock:005930", stock, redis.TTLMedium)\n\n// GetOrSet \ud328\ud134 (\uce90\uc2dc \ubbf8\uc2a4 \uc2dc \ud568\uc218 \ud638\ucd9c)\nerr := cache.GetOrSet(ctx, "stock:005930", &stock, redis.TTLMedium, func() (interface{}, error) {\n    return fetchStockFromDB("005930")\n})\n\n// \uc0ac\uc804 \uc815\uc758\ub41c TTL\nredis.TTLShort  // 1\ubd84 (\uc2e4\uc2dc\uac04 \uc2dc\uc138)\nredis.TTLMedium // 10\ubd84 (\uc885\ubaa9 \uc815\ubcf4)\nredis.TTLLong   // 1\uc2dc\uac04 (\ub9c8\uc2a4\ud130 \ub370\uc774\ud130)\nredis.TTLDaily  // 24\uc2dc\uac04 (\uc77c\ubcc4 \ub370\uc774\ud130)\n'})}),"\n",(0,d.jsx)(n.h3,{id:"http-\ud074\ub77c\uc774\uc5b8\ud2b8-\ud1b5\ud569",children:"HTTP \ud074\ub77c\uc774\uc5b8\ud2b8 \ud1b5\ud569"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-go",children:'// \ub808\uc774\ud2b8 \ub9ac\ubc0b\uc774 \uc801\uc6a9\ub41c HTTP \ud074\ub77c\uc774\uc5b8\ud2b8\nhttpClient := httputil.New(cfg, log).\n    WithRateLimiter(limiter, redis.KISRateLimit)\n\n// \uc694\uccad \uc2dc \uc790\ub3d9\uc73c\ub85c \ub808\uc774\ud2b8 \ub9ac\ubc0b \ub300\uae30\nresp, err := httpClient.Get(ctx, "https://api.kis.com/...")\n'})}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"\ud658\uacbd\ubcc0\uc218",children:"\ud658\uacbd\ubcc0\uc218"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"# Redis\nREDIS_HOST=localhost\nREDIS_PORT=6379\nREDIS_PASSWORD=\nREDIS_DB=0\nREDIS_ENABLED=true  # false\ub85c \uc124\uc815 \uc2dc \ubaa8\ub4e0 \uae30\ub2a5 \ube44\ud65c\uc131\ud654\n"})}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"\ub85c\uceec-\uc124\uc815",children:"\ub85c\uceec \uc124\uc815"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"# macOS (Homebrew)\nbrew install redis\nbrew services start redis\n\n# \uc0c1\ud0dc \ud655\uc778\nredis-cli ping  # \u2192 PONG\n\n# \uba54\ubaa8\ub9ac \uc0ac\uc6a9\ub7c9 \ud655\uc778\nredis-cli info memory | grep used_memory_human\n# \u2192 used_memory_human:2.5M (idle \uc0c1\ud0dc)\n"})}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"\ud14c\uc2a4\ud2b8",children:"\ud14c\uc2a4\ud2b8"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"# Redis \ud328\ud0a4\uc9c0 \ud14c\uc2a4\ud2b8\ncd backend\ngo test ./pkg/redis/...\n\n# Redis \uc5c6\uc774 \ud14c\uc2a4\ud2b8 (graceful fallback \ud655\uc778)\nREDIS_ENABLED=false go test ./...\n"})}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"scheduler",children:"Scheduler"}),"\n",(0,d.jsx)(n.h3,{id:"overview-1",children:"Overview"}),"\n",(0,d.jsx)(n.p,{children:"\uc2a4\ucf00\uc904\ub7ec\ub294 \uc8fc\uae30\uc801\uc778 \uc791\uc5c5\ub4e4\uc744 \uad00\ub9ac\ud569\ub2c8\ub2e4."}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"internal/scheduler/\n\u251c\u2500\u2500 scheduler.go      # \uc2a4\ucf00\uc904\ub7ec \ucf54\uc5b4\n\u2514\u2500\u2500 jobs/\n    \u251c\u2500\u2500 data_collection.go  # \ub370\uc774\ud130 \uc218\uc9d1\n    \u251c\u2500\u2500 maintenance.go      # \uce90\uc2dc \uc815\ub9ac\n    \u251c\u2500\u2500 universe.go         # Universe \uc0dd\uc131\n    \u2514\u2500\u2500 forecast.go         # Forecast \ud30c\uc774\ud504\ub77c\uc778\n"})}),"\n",(0,d.jsx)(n.h3,{id:"\ub4f1\ub85d\ub41c-\uc791\uc5c5",children:"\ub4f1\ub85d\ub41c \uc791\uc5c5"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"\uc791\uc5c5"}),(0,d.jsx)(n.th,{children:"\uc2a4\ucf00\uc904"}),(0,d.jsx)(n.th,{children:"\uc124\uba85"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"data_collection"})}),(0,d.jsx)(n.td,{children:"\ub9e4\uc77c 16:00"}),(0,d.jsx)(n.td,{children:"\uc804\uccb4 \ub370\uc774\ud130 \uc218\uc9d1"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"price_collection"})}),(0,d.jsx)(n.td,{children:"\ud3c9\uc77c 9-15\uc2dc \ub9e4\uc2dc\uac04"}),(0,d.jsx)(n.td,{children:"\uac00\uaca9 \ub370\uc774\ud130"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"investor_flow"})}),(0,d.jsx)(n.td,{children:"\ub9e4\uc77c 17:00"}),(0,d.jsx)(n.td,{children:"\ud22c\uc790\uc790 \uc218\uae09"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"disclosure_collection"})}),(0,d.jsx)(n.td,{children:"6\uc2dc\uac04\ub9c8\ub2e4"}),(0,d.jsx)(n.td,{children:"\uacf5\uc2dc \ub370\uc774\ud130"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"universe_generation"})}),(0,d.jsx)(n.td,{children:"\ub9e4\uc77c 18:00"}),(0,d.jsx)(n.td,{children:"Universe \uc0dd\uc131"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"forecast_pipeline"})}),(0,d.jsx)(n.td,{children:"\ub9e4\uc77c 18:30"}),(0,d.jsx)(n.td,{children:"\uc774\ubca4\ud2b8 \uac10\uc9c0/\uc608\uce21"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"cache_cleanup"})}),(0,d.jsx)(n.td,{children:"5\ubd84\ub9c8\ub2e4"}),(0,d.jsx)(n.td,{children:"\uce90\uc2dc \uc815\ub9ac"})]})]})]}),"\n",(0,d.jsx)(n.h3,{id:"cli-\uba85\ub839\uc5b4",children:"CLI \uba85\ub839\uc5b4"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"# \uc2a4\ucf00\uc904\ub7ec \uc2dc\uc791\ngo run ./cmd/quant scheduler start\n\n# \uc791\uc5c5 \ubaa9\ub85d\ngo run ./cmd/quant scheduler list\n\n# \ud2b9\uc815 \uc791\uc5c5 \uc989\uc2dc \uc2e4\ud589\ngo run ./cmd/quant scheduler run forecast_pipeline\n\n# \uc0c1\ud0dc \ud655\uc778\ngo run ./cmd/quant scheduler status\n"})}),"\n",(0,d.jsx)(n.h3,{id:"job-\uc778\ud130\ud398\uc774\uc2a4",children:"Job \uc778\ud130\ud398\uc774\uc2a4"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-go",children:"type Job interface {\n    Name() string                      // \uc791\uc5c5 \uc774\ub984\n    Schedule() string                  // Cron \uc2a4\ucf00\uc904 (6\uc790\ub9ac)\n    Run(ctx context.Context) error     // \uc2e4\ud589 \ub85c\uc9c1\n}\n"})}),"\n",(0,d.jsx)(n.h3,{id:"cron-\uc2a4\ucf00\uc904-\ud615\uc2dd",children:"Cron \uc2a4\ucf00\uc904 \ud615\uc2dd"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 \ucd08 (0-59)\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 \ubd84 (0-59)\n\u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 \uc2dc (0-23)\n\u2502 \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 \uc77c (1-31)\n\u2502 \u2502 \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500 \uc6d4 (1-12)\n\u2502 \u2502 \u2502 \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500 \uc694\uc77c (0-6, 0=\uc77c\uc694\uc77c)\n\u2502 \u2502 \u2502 \u2502 \u2502 \u2502\n0 30 18 * * *   \u2192 \ub9e4\uc77c 18:30:00\n0 0 16 * * 1-5  \u2192 \ud3c9\uc77c 16:00:00\n0 */5 * * * *   \u2192 5\ubd84\ub9c8\ub2e4\n"})}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.strong,{children:"Prev"}),": ",(0,d.jsx)(n.a,{href:"/aegis-v13/docs/guide/backend/audit-layer",children:"Audit Layer"}),"\n",(0,d.jsx)(n.strong,{children:"Next"}),": ",(0,d.jsx)(n.a,{href:"/aegis-v13/docs/guide/frontend/folder-structure",children:"Frontend Folder Structure"})]})]})}function o(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,d.jsx)(n,{...e,children:(0,d.jsx)(a,{...e})}):a(e)}}}]);