"use strict";(globalThis.webpackChunkdocs_site=globalThis.webpackChunkdocs_site||[]).push([[283],{7944(n,e,t){t.r(e),t.d(e,{assets:()=>a,contentTitle:()=>c,default:()=>h,frontMatter:()=>l,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"guide/backend/data-layer","title":"Data Layer","description":"S0 Data Collection + S1 Universe","source":"@site/docs/guide/backend/data-layer.md","sourceDirName":"guide/backend","slug":"/guide/backend/data-layer","permalink":"/aegis-v13/docs/guide/backend/data-layer","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"title":"Data Layer","description":"S0 Data Collection + S1 Universe"},"sidebar":"guideSidebar","previous":{"title":"Folder Structure","permalink":"/aegis-v13/docs/guide/backend/folder-structure"},"next":{"title":"Signals Layer","permalink":"/aegis-v13/docs/guide/backend/signals-layer"}}');var s=t(4848),i=t(8453);const l={sidebar_position:2,title:"Data Layer",description:"S0 Data Collection + S1 Universe"},c="Data Layer",a={},d=[{value:"\uc5ed\ud560",id:"\uc5ed\ud560",level:2},{value:"\uad6c\ud604 \uc0c1\ud0dc (2026-01-10)",id:"\uad6c\ud604-\uc0c1\ud0dc-2026-01-10",level:2},{value:"\ud3f4\ub354 \uad6c\uc870",id:"\ud3f4\ub354-\uad6c\uc870",level:2},{value:"S0: Data Collection",id:"s0-data-collection",level:2},{value:"\uc218\uc9d1 \ub300\uc0c1 \ub370\uc774\ud130",id:"\uc218\uc9d1-\ub300\uc0c1-\ub370\uc774\ud130",level:3},{value:"\uc18c\uc2a4 \uc778\ud130\ud398\uc774\uc2a4",id:"\uc18c\uc2a4-\uc778\ud130\ud398\uc774\uc2a4",level:3},{value:"Naver Source \uad6c\ud604",id:"naver-source-\uad6c\ud604",level:3},{value:"\ud22c\uc790\uc790 \uc218\uae09 \uc218\uc9d1",id:"\ud22c\uc790\uc790-\uc218\uae09-\uc218\uc9d1",level:3},{value:"S0: Quality Gate",id:"s0-quality-gate",level:2},{value:"Contract (\u2705 \uad6c\ud604\ub428)",id:"contract--\uad6c\ud604\ub428",level:3},{value:"Quality Gate \uad6c\ud604 (\u2705 \uad6c\ud604\ub428)",id:"quality-gate-\uad6c\ud604--\uad6c\ud604\ub428",level:3},{value:"S1: Universe Builder",id:"s1-universe-builder",level:2},{value:"Contract (\u2705 \uad6c\ud604\ub428)",id:"contract--\uad6c\ud604\ub428-1",level:3},{value:"Config (\u2705 \uad6c\ud604\ub428)",id:"config--\uad6c\ud604\ub428",level:3},{value:"Universe Builder \uad6c\ud604 (\u2705 \uad6c\ud604\ub428)",id:"universe-builder-\uad6c\ud604--\uad6c\ud604\ub428",level:3},{value:"\uc124\uc815",id:"\uc124\uc815",level:2},{value:"\uc2a4\ucf00\uc904",id:"\uc2a4\ucf00\uc904",level:2},{value:"DB \uc2a4\ud0a4\ub9c8",id:"db-\uc2a4\ud0a4\ub9c8",level:2}];function o(n){const e={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.header,{children:(0,s.jsx)(e.h1,{id:"data-layer",children:"Data Layer"})}),"\n",(0,s.jsxs)(e.blockquote,{children:["\n",(0,s.jsx)(e.p,{children:"S0: \ub370\uc774\ud130 \uc218\uc9d1/\ud488\uc9c8 + S1: \ud22c\uc790 \uc720\ub2c8\ubc84\uc2a4"}),"\n"]}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"\uc5ed\ud560",children:"\uc5ed\ud560"}),"\n",(0,s.jsxs)(e.table,{children:[(0,s.jsx)(e.thead,{children:(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.th,{children:"Stage"}),(0,s.jsx)(e.th,{children:"\uc5ed\ud560"}),(0,s.jsx)(e.th,{children:"\uc785\ub825"}),(0,s.jsx)(e.th,{children:"\ucd9c\ub825"})]})}),(0,s.jsxs)(e.tbody,{children:[(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.strong,{children:"S0"})}),(0,s.jsx)(e.td,{children:"\ub370\uc774\ud130 \uc218\uc9d1, \ud488\uc9c8 \uac80\uc99d"}),(0,s.jsx)(e.td,{children:"\uc678\ubd80 API"}),(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"DataQualitySnapshot"})})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.strong,{children:"S1"})}),(0,s.jsx)(e.td,{children:"\ud22c\uc790 \uac00\ub2a5 \uc885\ubaa9 \ud544\ud130\ub9c1"}),(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"DataQualitySnapshot"})}),(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"Universe"})})]})]})]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\ub370\uc774\ud130 \uc694\uad6c\uc0ac\ud56d"}),": ",(0,s.jsx)(e.a,{href:"/aegis-v13/docs/guide/architecture/data-requirements",children:"Data Requirements"})," \ucc38\uc870"]}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"\uad6c\ud604-\uc0c1\ud0dc-2026-01-10",children:"\uad6c\ud604 \uc0c1\ud0dc (2026-01-10)"}),"\n",(0,s.jsxs)(e.table,{children:[(0,s.jsx)(e.thead,{children:(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.th,{children:"\ucef4\ud3ec\ub10c\ud2b8"}),(0,s.jsx)(e.th,{children:"\uc0c1\ud0dc"}),(0,s.jsx)(e.th,{children:"\ud30c\uc77c"})]})}),(0,s.jsxs)(e.tbody,{children:[(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.strong,{children:"S0: Quality Gate"})}),(0,s.jsx)(e.td,{children:"\u2705 \uc644\ub8cc"}),(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"internal/s0_data/quality/validator.go"})})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.strong,{children:"S0: Repository"})}),(0,s.jsx)(e.td,{children:"\u2705 \uc644\ub8cc"}),(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"internal/s0_data/repository.go"})})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.strong,{children:"S1: Universe Builder"})}),(0,s.jsx)(e.td,{children:"\u2705 \uc644\ub8cc"}),(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"internal/s1_universe/builder.go"})})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.strong,{children:"S1: Repository"})}),(0,s.jsx)(e.td,{children:"\u2705 \uc644\ub8cc"}),(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"internal/s1_universe/repository.go"})})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"Data Sources (Naver/DART/KRX)"}),(0,s.jsx)(e.td,{children:"\u274c TODO"}),(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"internal/s0_data/sources/"})})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"Scheduler"}),(0,s.jsx)(e.td,{children:"\u274c TODO"}),(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"internal/s0_data/scheduler/"})})]})]})]}),"\n",(0,s.jsx)(e.h2,{id:"\ud3f4\ub354-\uad6c\uc870",children:"\ud3f4\ub354 \uad6c\uc870"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"internal/\n\u251c\u2500\u2500 s0_data/\n\u2502   \u251c\u2500\u2500 quality/\n\u2502   \u2502   \u251c\u2500\u2500 validator.go        # \u2705 \ub370\uc774\ud130 \uac80\uc99d\n\u2502   \u2502   \u2514\u2500\u2500 validator_test.go   # \u2705 \ud14c\uc2a4\ud2b8\n\u2502   \u2514\u2500\u2500 repository.go           # \u2705 DB \uc800\uc7a5 (quality_snapshots)\n\u2502\n\u251c\u2500\u2500 s1_universe/\n\u2502   \u251c\u2500\u2500 builder.go              # \u2705 Universe \uc0dd\uc131\n\u2502   \u251c\u2500\u2500 builder_test.go         # \u2705 \ud14c\uc2a4\ud2b8\n\u2502   \u2514\u2500\u2500 repository.go           # \u2705 DB \uc800\uc7a5 (universe_snapshots)\n\u2502\n\u2514\u2500\u2500 contracts/                  # \u2705 \ud0c0\uc785 \uc815\uc758 (SSOT)\n    \u251c\u2500\u2500 data.go                 # DataQualitySnapshot\n    \u2514\u2500\u2500 universe.go             # Universe\n"})}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"TODO"}),":"]}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"sources/"})," (Naver, DART, KRX \uc218\uc9d1)"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"scheduler/"})," (\uc2a4\ucf00\uc904\ub7ec)"]}),"\n"]}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"s0-data-collection",children:"S0: Data Collection"}),"\n",(0,s.jsx)(e.h3,{id:"\uc218\uc9d1-\ub300\uc0c1-\ub370\uc774\ud130",children:"\uc218\uc9d1 \ub300\uc0c1 \ub370\uc774\ud130"}),"\n",(0,s.jsxs)(e.table,{children:[(0,s.jsx)(e.thead,{children:(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.th,{children:"\ub370\uc774\ud130"}),(0,s.jsx)(e.th,{children:"\uc18c\uc2a4"}),(0,s.jsx)(e.th,{children:"\ucee4\ubc84\ub9ac\uc9c0 \ubaa9\ud45c"}),(0,s.jsx)(e.th,{children:"\uac31\uc2e0 \uc8fc\uae30"})]})}),(0,s.jsxs)(e.tbody,{children:[(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"\uac00\uaca9/\uac70\ub798\ub7c9"}),(0,s.jsx)(e.td,{children:"Naver"}),(0,s.jsx)(e.td,{children:"100%"}),(0,s.jsx)(e.td,{children:"Daily"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"\uc2dc\uac00\ucd1d\uc561"}),(0,s.jsx)(e.td,{children:"Naver"}),(0,s.jsx)(e.td,{children:"95%+"}),(0,s.jsx)(e.td,{children:"Daily"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"\ud22c\uc790\uc790 \uc218\uae09"}),(0,s.jsx)(e.td,{children:"Naver"}),(0,s.jsx)(e.td,{children:"80%+"}),(0,s.jsx)(e.td,{children:"Daily"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"\uc7ac\ubb34\uc81c\ud45c"}),(0,s.jsx)(e.td,{children:"DART/Naver"}),(0,s.jsx)(e.td,{children:"80%+"}),(0,s.jsx)(e.td,{children:"Quarterly"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"\ubc38\ub958\uc5d0\uc774\uc158"}),(0,s.jsx)(e.td,{children:"Naver/\uacc4\uc0b0"}),(0,s.jsx)(e.td,{children:"80%+"}),(0,s.jsx)(e.td,{children:"Daily"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"\uacf5\uc2dc"}),(0,s.jsx)(e.td,{children:"DART"}),(0,s.jsx)(e.td,{children:"70%+"}),(0,s.jsx)(e.td,{children:"Real-time"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"\uc885\ubaa9 \ub9c8\uc2a4\ud130"}),(0,s.jsx)(e.td,{children:"KRX"}),(0,s.jsx)(e.td,{children:"100%"}),(0,s.jsx)(e.td,{children:"Daily"})]})]})]}),"\n",(0,s.jsx)(e.h3,{id:"\uc18c\uc2a4-\uc778\ud130\ud398\uc774\uc2a4",children:"\uc18c\uc2a4 \uc778\ud130\ud398\uc774\uc2a4"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-go",children:"// internal/s0_data/sources/source.go\n\ntype DataSource interface {\n    Name() string\n    Fetch(ctx context.Context, opts FetchOptions) error\n}\n\ntype FetchOptions struct {\n    Symbols   []string   // \ud2b9\uc815 \uc885\ubaa9\ub9cc (nil = \uc804\uccb4)\n    DateFrom  time.Time\n    DateTo    time.Time\n}\n"})}),"\n",(0,s.jsx)(e.h3,{id:"naver-source-\uad6c\ud604",children:"Naver Source \uad6c\ud604"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-go",children:'// internal/s0_data/sources/naver/prices.go\n\ntype PriceSource struct {\n    client *NaverClient\n    repo   *repository.PriceRepository\n}\n\nfunc (s *PriceSource) Name() string { return "naver_prices" }\n\nfunc (s *PriceSource) Fetch(ctx context.Context, opts FetchOptions) error {\n    stocks := opts.Symbols\n    if len(stocks) == 0 {\n        stocks = s.repo.GetAllStockCodes(ctx)\n    }\n\n    for _, code := range stocks {\n        data, err := s.client.FetchOHLCV(ctx, code, opts.DateFrom, opts.DateTo)\n        if err != nil {\n            s.logger.Warn("fetch failed", "code", code, "error", err)\n            continue\n        }\n\n        if err := s.repo.SaveOHLCV(ctx, data); err != nil {\n            return fmt.Errorf("save OHLCV failed: %w", err)\n        }\n    }\n\n    return nil\n}\n'})}),"\n",(0,s.jsx)(e.h3,{id:"\ud22c\uc790\uc790-\uc218\uae09-\uc218\uc9d1",children:"\ud22c\uc790\uc790 \uc218\uae09 \uc218\uc9d1"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-go",children:'// internal/s0_data/sources/naver/investor.go\n\ntype InvestorSource struct {\n    client *NaverClient\n    repo   *repository.InvestorRepository\n}\n\nfunc (s *InvestorSource) Fetch(ctx context.Context, opts FetchOptions) error {\n    stocks := opts.Symbols\n    if len(stocks) == 0 {\n        stocks = s.repo.GetAllStockCodes(ctx)\n    }\n\n    for _, code := range stocks {\n        flow, err := s.client.FetchInvestorFlow(ctx, code, opts.DateFrom, opts.DateTo)\n        if err != nil {\n            continue // \uc77c\ubd80 \uc885\ubaa9 \uc2e4\ud328 \ud5c8\uc6a9\n        }\n\n        if err := s.repo.SaveInvestorFlow(ctx, flow); err != nil {\n            return fmt.Errorf("save investor flow failed: %w", err)\n        }\n    }\n\n    return nil\n}\n'})}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"s0-quality-gate",children:"S0: Quality Gate"}),"\n",(0,s.jsx)(e.h3,{id:"contract--\uad6c\ud604\ub428",children:"Contract (\u2705 \uad6c\ud604\ub428)"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-go",children:'// internal/contracts/data.go\n\ntype DataQualitySnapshot struct {\n    Date         time.Time          `json:"date"`\n    TotalStocks  int                `json:"total_stocks"`\n    ValidStocks  int                `json:"valid_stocks"`\n    Coverage     map[string]float64 `json:"coverage"`     // \uc2e4\uc81c \uad6c\ud604\n    QualityScore float64            `json:"quality_score"`\n}\n\n// IsValid checks if the snapshot passed the quality gate\nfunc (s *DataQualitySnapshot) IsValid() bool {\n    return s.QualityScore >= 0.70 // 70% \uc774\uc0c1\n}\n\n// Coverage keys:\n// - "price": \uac00\uaca9 \ucee4\ubc84\ub9ac\uc9c0\n// - "volume": \uac70\ub798\ub7c9 \ucee4\ubc84\ub9ac\uc9c0\n// - "market_cap": \uc2dc\uac00\ucd1d\uc561 \ucee4\ubc84\ub9ac\uc9c0\n// - "fundamentals": \uc7ac\ubb34\uc81c\ud45c \ucee4\ubc84\ub9ac\uc9c0\n// - "investor": \uc218\uae09 \ucee4\ubc84\ub9ac\uc9c0\n'})}),"\n",(0,s.jsx)(e.h3,{id:"quality-gate-\uad6c\ud604--\uad6c\ud604\ub428",children:"Quality Gate \uad6c\ud604 (\u2705 \uad6c\ud604\ub428)"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-go",children:'// internal/s0_data/quality/validator.go\n\ntype QualityGate struct {\n    db     *pgxpool.Pool\n    config Config\n}\n\ntype Config struct {\n    MinPriceCoverage      float64 `yaml:"min_price_coverage"`\n    MinVolumeCoverage     float64 `yaml:"min_volume_coverage"`\n    MinMarketCapCoverage  float64 `yaml:"min_market_cap_coverage"`\n    MinFinancialCoverage  float64 `yaml:"min_financial_coverage"`\n    MinInvestorCoverage   float64 `yaml:"min_investor_coverage"`\n    MinDisclosureCoverage float64 `yaml:"min_disclosure_coverage"`\n}\n\nfunc NewQualityGate(db *pgxpool.Pool, config Config) *QualityGate {\n    return &QualityGate{db: db, config: config}\n}\n\n// Check validates data quality for a given date\n// \u2b50 SSOT: S0 \u2192 S1 \ud488\uc9c8 \uac80\uc99d\nfunc (g *QualityGate) Check(ctx context.Context, date time.Time) (*contracts.DataQualitySnapshot, error) {\n    snapshot := &contracts.DataQualitySnapshot{\n        Date:     date,\n        Coverage: make(map[string]float64),\n    }\n\n    // 1. \uc804\uccb4 \uc885\ubaa9 \uc218\n    totalStocks, err := g.countTotalStocks(ctx)\n    if err != nil {\n        return nil, fmt.Errorf("count total stocks: %w", err)\n    }\n    snapshot.TotalStocks = totalStocks\n\n    // 2. \ucee4\ubc84\ub9ac\uc9c0 \uccb4\ud06c\n    coverage, err := g.checkCoverage(ctx, date)\n    if err != nil {\n        return nil, fmt.Errorf("check coverage: %w", err)\n    }\n    snapshot.Coverage = coverage\n\n    // 3. \ud488\uc9c8 \uc810\uc218 \uacc4\uc0b0 (\uac00\uc911 \ud3c9\uade0)\n    snapshot.QualityScore = g.calculateScore(coverage)\n    snapshot.ValidStocks = int(float64(totalStocks) * snapshot.QualityScore)\n\n    return snapshot, nil\n}\n\n// calculateScore calculates overall quality score using weighted average\nfunc (g *QualityGate) calculateScore(coverage map[string]float64) float64 {\n    weights := map[string]float64{\n        "price":        0.30, // \uac00\uaca9 \ub370\uc774\ud130 \ud544\uc218\n        "volume":       0.30, // \uac70\ub798\ub7c9 \ub370\uc774\ud130 \ud544\uc218\n        "market_cap":   0.15, // \uc2dc\uac00\ucd1d\uc561\n        "fundamentals": 0.15, // \uc7ac\ubb34\uc81c\ud45c\n        "investor":     0.10, // \uc218\uae09\n    }\n\n    score := 0.0\n    for key, weight := range weights {\n        if cov, exists := coverage[key]; exists {\n            score += cov * weight\n        }\n    }\n    return score\n}\n'})}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\ud14c\uc2a4\ud2b8 \uacb0\uacfc"})," (2026-01-08 \uae30\uc900):"]}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\uc804\uccb4 \uc885\ubaa9: 922\uac1c"}),"\n",(0,s.jsx)(e.li,{children:"\uc720\ud6a8 \uc885\ubaa9: 737\uac1c"}),"\n",(0,s.jsxs)(e.li,{children:["\ud488\uc9c8 \uc810\uc218: ",(0,s.jsx)(e.strong,{children:"80.04%"})," \u2705"]}),"\n",(0,s.jsxs)(e.li,{children:["\ucee4\ubc84\ub9ac\uc9c0:","\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Price: 98.81%"}),"\n",(0,s.jsx)(e.li,{children:"Volume: 95.55%"}),"\n",(0,s.jsx)(e.li,{children:"Fundamentals: 90.24%"}),"\n",(0,s.jsx)(e.li,{children:"Investor: 82.00%"}),"\n",(0,s.jsx)(e.li,{children:"Market Cap: 0.00% (\ub370\uc774\ud130 \ub204\ub77d)"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"s1-universe-builder",children:"S1: Universe Builder"}),"\n",(0,s.jsx)(e.h3,{id:"contract--\uad6c\ud604\ub428-1",children:"Contract (\u2705 \uad6c\ud604\ub428)"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-go",children:'// internal/contracts/universe.go\n\ntype Universe struct {\n    Date       time.Time         `json:"date"`\n    Stocks     []string          `json:"stocks"`   // \ud3ec\ud568 \uc885\ubaa9\n    Excluded   map[string]string `json:"excluded"` // \uc81c\uc678 \uc885\ubaa9: \uc0ac\uc720\n    TotalCount int               `json:"total_count"`\n}\n'})}),"\n",(0,s.jsx)(e.h3,{id:"config--\uad6c\ud604\ub428",children:"Config (\u2705 \uad6c\ud604\ub428)"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-go",children:'// internal/s1_universe/builder.go\n\ntype Config struct {\n    MinMarketCap   int64    `yaml:"min_market_cap"`    // \ucd5c\uc18c \uc2dc\ucd1d (\uc5b5)\n    MinVolume      int64    `yaml:"min_volume"`        // \ucd5c\uc18c \uac70\ub798\ub300\uae08 (\ubc31\ub9cc)\n    MinListingDays int      `yaml:"min_listing_days"`  // \ucd5c\uc18c \uc0c1\uc7a5\uc77c\uc218\n    ExcludeAdmin   bool     `yaml:"exclude_admin"`     // \uad00\ub9ac\uc885\ubaa9 \uc81c\uc678\n    ExcludeHalt    bool     `yaml:"exclude_halt"`      // \uac70\ub798\uc815\uc9c0 \uc81c\uc678\n    ExcludeSPAC    bool     `yaml:"exclude_spac"`      // SPAC \uc81c\uc678\n    ExcludeSectors []string `yaml:"exclude_sectors"`   // \uc81c\uc678 \uc139\ud130\n}\n\ntype Stock struct {\n    Code        string\n    Name        string\n    Market      string\n    Sector      string\n    ListingDate time.Time\n    MarketCap   int64 // \uc2dc\uac00\ucd1d\uc561 (\uc6d0)\n    AvgVolume   int64 // \ud3c9\uade0 \uac70\ub798\ub300\uae08 (\uc6d0)\n    ListingDays int   // \uc0c1\uc7a5\uc77c\uc218\n    IsAdmin     bool  // \uad00\ub9ac\uc885\ubaa9 \uc5ec\ubd80\n    IsHalted    bool  // \uac70\ub798\uc815\uc9c0 \uc5ec\ubd80\n    IsSPAC      bool  // SPAC \uc5ec\ubd80\n}\n'})}),"\n",(0,s.jsx)(e.h3,{id:"universe-builder-\uad6c\ud604--\uad6c\ud604\ub428",children:"Universe Builder \uad6c\ud604 (\u2705 \uad6c\ud604\ub428)"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-go",children:'// internal/s1_universe/builder.go\n\ntype Builder struct {\n    db     *pgxpool.Pool\n    config Config\n}\n\nfunc NewBuilder(db *pgxpool.Pool, config Config) *Builder {\n    return &Builder{db: db, config: config}\n}\n\n// Build constructs the investable universe based on quality snapshot\n// \u2b50 SSOT: S1 \u2192 S2 \uc720\ub2c8\ubc84\uc2a4 \uc0dd\uc131\nfunc (b *Builder) Build(ctx context.Context, snapshot *contracts.DataQualitySnapshot) (*contracts.Universe, error) {\n    // Quality gate \ud1b5\uacfc \ud655\uc778\n    if !snapshot.IsValid() {\n        return nil, fmt.Errorf("data quality gate not passed: score=%.2f", snapshot.QualityScore)\n    }\n\n    universe := &contracts.Universe{\n        Date:     snapshot.Date,\n        Stocks:   make([]string, 0),\n        Excluded: make(map[string]string),\n    }\n\n    // \uc804\uccb4 \uc885\ubaa9 \uc870\ud68c\n    stocks, err := b.getAllStocks(ctx, snapshot.Date)\n    if err != nil {\n        return nil, fmt.Errorf("get all stocks: %w", err)\n    }\n\n    // \ud544\ud130\ub9c1\n    for _, stock := range stocks {\n        reason := b.checkExclusion(stock)\n        if reason != "" {\n            universe.Excluded[stock.Code] = reason\n            continue\n        }\n        universe.Stocks = append(universe.Stocks, stock.Code)\n    }\n\n    universe.TotalCount = len(universe.Stocks)\n    return universe, nil\n}\n\n// checkExclusion checks if a stock should be excluded and returns the reason\nfunc (b *Builder) checkExclusion(stock Stock) string {\n    // \uc6b0\uc120\uc21c\uc704 \uc21c\uc11c\ub85c \uccb4\ud06c\n\n    // 1. \uac70\ub798\uc815\uc9c0\n    if b.config.ExcludeHalt && stock.IsHalted {\n        return "\uac70\ub798\uc815\uc9c0"\n    }\n\n    // 2. \uad00\ub9ac\uc885\ubaa9\n    if b.config.ExcludeAdmin && stock.IsAdmin {\n        return "\uad00\ub9ac\uc885\ubaa9"\n    }\n\n    // 3. SPAC\n    if b.config.ExcludeSPAC && stock.IsSPAC {\n        return "SPAC"\n    }\n\n    // 4. \uc2dc\uac00\ucd1d\uc561 \ubbf8\ub2ec\n    minMarketCap := b.config.MinMarketCap * 100_000_000 // \uc5b5 \u2192 \uc6d0\n    if stock.MarketCap < minMarketCap {\n        return fmt.Sprintf("\uc2dc\uac00\ucd1d\uc561 \ubbf8\ub2ec (%d\uc5b5)", stock.MarketCap/100_000_000)\n    }\n\n    // 5. \uac70\ub798\ub300\uae08 \ubbf8\ub2ec\n    minVolume := b.config.MinVolume * 1_000_000 // \ubc31\ub9cc \u2192 \uc6d0\n    if stock.AvgVolume < minVolume {\n        return fmt.Sprintf("\uac70\ub798\ub300\uae08 \ubbf8\ub2ec (%d\ubc31\ub9cc)", stock.AvgVolume/1_000_000)\n    }\n\n    // 6. \uc0c1\uc7a5\uc77c\uc218 \ubbf8\ub2ec\n    if stock.ListingDays < b.config.MinListingDays {\n        return fmt.Sprintf("\uc0c1\uc7a5\uc77c\uc218 \ubbf8\ub2ec (%d\uc77c)", stock.ListingDays)\n    }\n\n    // 7. \uc81c\uc678 \uc139\ud130\n    for _, sector := range b.config.ExcludeSectors {\n        if stock.Sector == sector {\n            return fmt.Sprintf("\uc81c\uc678 \uc139\ud130 (%s)", sector)\n        }\n    }\n\n    return "" // \ud1b5\uacfc\n}\n'})}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\ud14c\uc2a4\ud2b8 \uacb0\uacfc"})," (2026-01-08 \uae30\uc900):"]}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\ud22c\uc790 \uac00\ub2a5 \uc720\ub2c8\ubc84\uc2a4: ",(0,s.jsx)(e.strong,{children:"911\uc885\ubaa9"})," \u2705"]}),"\n",(0,s.jsx)(e.li,{children:"\uc81c\uc678\ub41c \uc885\ubaa9: 11\uac1c (\uc0c1\uc7a5\uc77c\uc218 30\uc77c \ubbf8\ub9cc)"}),"\n",(0,s.jsx)(e.li,{children:"\ud544\ud130\ub9c1 \uc870\uac74: \uc0c1\uc7a5 30\uc77c \uc774\uc0c1"}),"\n"]}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"\uc124\uc815",children:"\uc124\uc815"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-yaml",children:'# config/data.yaml\n\n# S0: \ub370\uc774\ud130 \uc218\uc9d1\ndata:\n  sources:\n    naver:\n      rate_limit: 10  # requests per second\n      timeout: 30s\n    dart:\n      api_key: ${DART_API_KEY}\n      rate_limit: 100  # requests per minute\n    krx:\n      timeout: 60s\n\n  quality:\n    min_price_coverage: 1.0\n    min_volume_coverage: 1.0\n    min_market_cap_coverage: 0.95\n    min_financial_coverage: 0.80\n    min_investor_coverage: 0.80\n    min_disclosure_coverage: 0.70\n\n# S1: \uc720\ub2c8\ubc84\uc2a4\nuniverse:\n  min_market_cap: 1000      # 1000\uc5b5 \uc774\uc0c1\n  min_volume: 500           # 5\uc5b5 \uc774\uc0c1\n  min_listing_days: 90      # \uc0c1\uc7a5 90\uc77c \uc774\uc0c1\n  exclude_admin: true\n  exclude_halt: true\n  exclude_spac: true\n  exclude_sectors:\n    - "\uae08\uc735"\n    - "\ubcf4\ud5d8"\n'})}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"\uc2a4\ucf00\uc904",children:"\uc2a4\ucf00\uc904"}),"\n",(0,s.jsxs)(e.table,{children:[(0,s.jsx)(e.thead,{children:(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.th,{children:"\uc791\uc5c5"}),(0,s.jsx)(e.th,{children:"\uc2dc\uac04"}),(0,s.jsx)(e.th,{children:"\uc124\uba85"})]})}),(0,s.jsxs)(e.tbody,{children:[(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"\uc885\ubaa9 \ub9c8\uc2a4\ud130"}),(0,s.jsx)(e.td,{children:"08:00"}),(0,s.jsx)(e.td,{children:"\uc7a5 \uc2dc\uc791 \uc804"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"\uac00\uaca9/\uac70\ub798\ub7c9"}),(0,s.jsx)(e.td,{children:"15:45"}),(0,s.jsx)(e.td,{children:"\uc7a5 \ub9c8\uac10 \ud6c4"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"\uc2dc\uac00\ucd1d\uc561"}),(0,s.jsx)(e.td,{children:"15:50"}),(0,s.jsx)(e.td,{children:"\uac00\uaca9 \uc218\uc9d1 \ud6c4"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"\ud22c\uc790\uc790 \uc218\uae09"}),(0,s.jsx)(e.td,{children:"16:05"}),(0,s.jsx)(e.td,{children:"\uc9d1\uacc4 \uc644\ub8cc \ud6c4"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"\ud488\uc9c8 \uccb4\ud06c"}),(0,s.jsx)(e.td,{children:"16:30"}),(0,s.jsx)(e.td,{children:"\uc218\uc9d1 \uc644\ub8cc \ud6c4"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"Universe \uc0dd\uc131"}),(0,s.jsx)(e.td,{children:"16:35"}),(0,s.jsx)(e.td,{children:"\ud488\uc9c8 \ud1b5\uacfc \ud6c4"})]})]})]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-go",children:'// internal/s0_data/scheduler/scheduler.go\n\ntype DailySchedule struct {\n    tasks []ScheduledTask\n}\n\nfunc DefaultDailySchedule() *DailySchedule {\n    return &DailySchedule{\n        tasks: []ScheduledTask{\n            {Time: "08:00", Task: "stocks"},\n            {Time: "15:45", Task: "prices"},\n            {Time: "15:50", Task: "market_cap"},\n            {Time: "16:05", Task: "investor"},\n            {Time: "16:30", Task: "quality_check"},\n            {Time: "16:35", Task: "universe_build"},\n        },\n    }\n}\n'})}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"db-\uc2a4\ud0a4\ub9c8",children:"DB \uc2a4\ud0a4\ub9c8"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"-- \ub370\uc774\ud130 \uc2a4\ud0a4\ub9c8\nCREATE SCHEMA IF NOT EXISTS data;\n\n-- \uac00\uaca9 \ub370\uc774\ud130\nCREATE TABLE data.prices (\n    stock_code  VARCHAR(10) NOT NULL,\n    date        DATE NOT NULL,\n    open        BIGINT,\n    high        BIGINT,\n    low         BIGINT,\n    close       BIGINT NOT NULL,\n    volume      BIGINT,\n    value       BIGINT,\n    adj_close   DECIMAL(15,2),\n    adj_factor  DECIMAL(10,6) DEFAULT 1.0,\n    created_at  TIMESTAMPTZ DEFAULT NOW(),\n    PRIMARY KEY (stock_code, date)\n);\n\n-- \ud22c\uc790\uc790 \uc218\uae09\nCREATE TABLE data.investor_flow (\n    stock_code    VARCHAR(10) NOT NULL,\n    date          DATE NOT NULL,\n    foreign_net   BIGINT,      -- \uc678\uad6d\uc778 \uc21c\ub9e4\uc218\n    inst_net      BIGINT,      -- \uae30\uad00 \uc21c\ub9e4\uc218\n    individual_net BIGINT,     -- \uac1c\uc778 \uc21c\ub9e4\uc218\n    financial_net BIGINT,      -- \uae08\uc735\ud22c\uc790\n    insurance_net BIGINT,      -- \ubcf4\ud5d8\n    trust_net     BIGINT,      -- \ud22c\uc2e0\n    pension_net   BIGINT,      -- \uc5f0\uae30\uae08\n    created_at    TIMESTAMPTZ DEFAULT NOW(),\n    PRIMARY KEY (stock_code, date)\n);\n\n-- \ud488\uc9c8 \uc2a4\ub0c5\uc0f7\nCREATE TABLE data.quality_snapshots (\n    id            SERIAL PRIMARY KEY,\n    date          DATE NOT NULL UNIQUE,\n    total_stocks  INT,\n    valid_stocks  INT,\n    coverage      JSONB,\n    quality_score DECIMAL(5,4),\n    passed_gate   BOOLEAN,\n    issues        JSONB,\n    created_at    TIMESTAMPTZ DEFAULT NOW()\n);\n\n-- \uc720\ub2c8\ubc84\uc2a4 \uc2a4\ub0c5\uc0f7\nCREATE TABLE data.universe_snapshots (\n    id          SERIAL PRIMARY KEY,\n    date        DATE NOT NULL UNIQUE,\n    stocks      TEXT[],\n    excluded    JSONB,\n    total_count INT,\n    config      JSONB,\n    created_at  TIMESTAMPTZ DEFAULT NOW()\n);\n\n-- \uc778\ub371\uc2a4\nCREATE INDEX idx_prices_date ON data.prices(date);\nCREATE INDEX idx_investor_flow_date ON data.investor_flow(date);\n"})}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"Prev"}),": ",(0,s.jsx)(e.a,{href:"/aegis-v13/docs/guide/backend/folder-structure",children:"Folder Structure"}),"\n",(0,s.jsx)(e.strong,{children:"Next"}),": ",(0,s.jsx)(e.a,{href:"/aegis-v13/docs/guide/backend/signals-layer",children:"Signals Layer"})]})]})}function h(n={}){const{wrapper:e}={...(0,i.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(o,{...n})}):o(n)}},8453(n,e,t){t.d(e,{R:()=>l,x:()=>c});var r=t(6540);const s={},i=r.createContext(s);function l(n){const e=r.useContext(i);return r.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:l(n.components),r.createElement(i.Provider,{value:e},n.children)}}}]);