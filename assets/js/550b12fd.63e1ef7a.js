"use strict";(globalThis.webpackChunkdocs_site=globalThis.webpackChunkdocs_site||[]).push([[976],{7643(n,e,t){t.r(e),t.d(e,{assets:()=>c,contentTitle:()=>s,default:()=>g,frontMatter:()=>a,metadata:()=>o,toc:()=>l});const o=JSON.parse('{"id":"guide/backend/portfolio-layer","title":"Portfolio Layer","description":"S5 \ud3ec\ud2b8\ud3f4\ub9ac\uc624 \uad6c\uc131","source":"@site/docs/guide/backend/portfolio-layer.md","sourceDirName":"guide/backend","slug":"/guide/backend/portfolio-layer","permalink":"/aegis-v13/docs/guide/backend/portfolio-layer","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5,"title":"Portfolio Layer","description":"S5 \ud3ec\ud2b8\ud3f4\ub9ac\uc624 \uad6c\uc131"},"sidebar":"guideSidebar","previous":{"title":"Selection Layer","permalink":"/aegis-v13/docs/guide/backend/selection-layer"},"next":{"title":"Execution Layer","permalink":"/aegis-v13/docs/guide/backend/execution-layer"}}');var i=t(4848),r=t(8453);const a={sidebar_position:5,title:"Portfolio Layer",description:"S5 \ud3ec\ud2b8\ud3f4\ub9ac\uc624 \uad6c\uc131"},s="Portfolio Layer",c={},l=[{value:"\ucc45\uc784",id:"\ucc45\uc784",level:2},{value:"\ud3f4\ub354 \uad6c\uc870",id:"\ud3f4\ub354-\uad6c\uc870",level:2},{value:"Portfolio Constructor",id:"portfolio-constructor",level:2},{value:"\uc778\ud130\ud398\uc774\uc2a4",id:"\uc778\ud130\ud398\uc774\uc2a4",level:3},{value:"\uad6c\ud604",id:"\uad6c\ud604",level:3},{value:"Weight \uacc4\uc0b0 \ubc29\uc2dd",id:"weight-\uacc4\uc0b0-\ubc29\uc2dd",level:2},{value:"Option 1: Equal Weight (\ub3d9\uc77c \ube44\uc911)",id:"option-1-equal-weight-\ub3d9\uc77c-\ube44\uc911",level:3},{value:"Option 2: Score-Based (\uc810\uc218 \ube44\ub840)",id:"option-2-score-based-\uc810\uc218-\ube44\ub840",level:3},{value:"Option 3: Risk Parity (\ub9ac\uc2a4\ud06c \ud328\ub9ac\ud2f0)",id:"option-3-risk-parity-\ub9ac\uc2a4\ud06c-\ud328\ub9ac\ud2f0",level:3},{value:"\uc81c\uc57d\uc870\uac74",id:"\uc81c\uc57d\uc870\uac74",level:2},{value:"\uc124\uc815 \uc608\uc2dc (YAML)",id:"\uc124\uc815-\uc608\uc2dc-yaml",level:2},{value:"DB \uc2a4\ud0a4\ub9c8",id:"db-\uc2a4\ud0a4\ub9c8",level:2}];function d(n){const e={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",p:"p",pre:"pre",strong:"strong",...(0,r.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.header,{children:(0,i.jsx)(e.h1,{id:"portfolio-layer",children:"Portfolio Layer"})}),"\n",(0,i.jsxs)(e.blockquote,{children:["\n",(0,i.jsx)(e.p,{children:"S5: \ud3ec\ud2b8\ud3f4\ub9ac\uc624 \uad6c\uc131"}),"\n"]}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"\ucc45\uc784",children:"\ucc45\uc784"}),"\n",(0,i.jsxs)(e.p,{children:["\ub7ad\ud0b9 \uacb0\uacfc\ub97c \ubc14\ud0d5\uc73c\ub85c ",(0,i.jsx)(e.strong,{children:"\ubaa9\ud45c \ud3ec\ud2b8\ud3f4\ub9ac\uc624"})," \uc0b0\ucd9c"]}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"\ud3f4\ub354-\uad6c\uc870",children:"\ud3f4\ub354 \uad6c\uc870"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"internal/portfolio/\n\u251c\u2500\u2500 constructor.go   # PortfolioConstructor \uad6c\ud604\n\u251c\u2500\u2500 rebalancer.go    # \ub9ac\ubc38\ub7f0\uc2f1 \ub85c\uc9c1\n\u2514\u2500\u2500 constraints.go   # \uc81c\uc57d\uc870\uac74 \uac80\uc99d\n"})}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"portfolio-constructor",children:"Portfolio Constructor"}),"\n",(0,i.jsx)(e.h3,{id:"\uc778\ud130\ud398\uc774\uc2a4",children:"\uc778\ud130\ud398\uc774\uc2a4"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"type PortfolioConstructor interface {\n    Construct(ctx context.Context, ranked []RankedStock) (*TargetPortfolio, error)\n}\n"})}),"\n",(0,i.jsx)(e.h3,{id:"\uad6c\ud604",children:"\uad6c\ud604"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'// internal/portfolio/constructor.go\n\ntype constructor struct {\n    config     PortfolioConfig\n    current    CurrentPortfolio  // \ud604\uc7ac \ubcf4\uc720\n    constraints Constraints\n}\n\ntype PortfolioConfig struct {\n    MaxPositions   int     `yaml:"max_positions"`    // \ucd5c\ub300 \uc885\ubaa9 \uc218\n    MaxWeight      float64 `yaml:"max_weight"`       // \ucd5c\ub300 \ube44\uc911 (20%)\n    MinWeight      float64 `yaml:"min_weight"`       // \ucd5c\uc18c \ube44\uc911 (2%)\n    CashReserve    float64 `yaml:"cash_reserve"`     // \ud604\uae08 \ubcf4\uc720 (5%)\n    TurnoverLimit  float64 `yaml:"turnover_limit"`   // \ud68c\uc804\uc728 \uc81c\ud55c (30%)\n}\n\nfunc (c *constructor) Construct(ctx context.Context, ranked []contracts.RankedStock) (*contracts.TargetPortfolio, error) {\n    target := &contracts.TargetPortfolio{\n        Date:      time.Now(),\n        Positions: make([]contracts.TargetPosition, 0),\n        Cash:      c.config.CashReserve,\n    }\n\n    // 1. Top N \uc120\ud0dd\n    topN := c.selectTopN(ranked)\n\n    // 2. \ube44\uc911 \uacc4\uc0b0 (\uc810\uc218 \uae30\ubc18 \uac00\uc911)\n    weights := c.calculateWeights(topN)\n\n    // 3. \uc81c\uc57d\uc870\uac74 \uc801\uc6a9\n    weights = c.applyConstraints(weights)\n\n    // 4. \ud604\uc7ac \ud3ec\ud2b8\ud3f4\ub9ac\uc624\uc640 \ube44\uad50\ud558\uc5ec Action \uacb0\uc815\n    for code, weight := range weights {\n        action := c.determineAction(code, weight)\n\n        target.Positions = append(target.Positions, contracts.TargetPosition{\n            Code:      code,\n            Name:      c.getStockName(code),\n            Weight:    weight,\n            TargetQty: c.calculateQuantity(code, weight),\n            Action:    action,\n            Reason:    c.getActionReason(code, action),\n        })\n    }\n\n    // 5. \ub9e4\ub3c4 \uc885\ubaa9 \ucd94\uac00 (\ud604\uc7ac \ubcf4\uc720 \uc911 \ubaa9\ud45c\uc5d0 \uc5c6\ub294 \uac83)\n    target.Positions = append(target.Positions, c.getSellPositions(weights)...)\n\n    return target, nil\n}\n\nfunc (c *constructor) determineAction(code string, targetWeight float64) contracts.Action {\n    currentWeight := c.current.GetWeight(code)\n\n    if currentWeight == 0 {\n        return contracts.ActionBuy\n    }\n    if targetWeight == 0 {\n        return contracts.ActionSell\n    }\n\n    // \ube44\uc911 \ubcc0\ud654\uac00 \ubbf8\ubbf8\ud558\uba74 Hold\n    diff := math.Abs(targetWeight - currentWeight)\n    if diff < 0.02 { // 2% \ubbf8\ub9cc\n        return contracts.ActionHold\n    }\n\n    if targetWeight > currentWeight {\n        return contracts.ActionBuy\n    }\n    return contracts.ActionSell\n}\n'})}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"weight-\uacc4\uc0b0-\ubc29\uc2dd",children:"Weight \uacc4\uc0b0 \ubc29\uc2dd"}),"\n",(0,i.jsx)(e.h3,{id:"option-1-equal-weight-\ub3d9\uc77c-\ube44\uc911",children:"Option 1: Equal Weight (\ub3d9\uc77c \ube44\uc911)"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"func (c *constructor) equalWeight(n int) map[string]float64 {\n    available := 1.0 - c.config.CashReserve\n    weight := available / float64(n)\n\n    weights := make(map[string]float64)\n    for _, stock := range topN {\n        weights[stock.Code] = weight\n    }\n    return weights\n}\n"})}),"\n",(0,i.jsx)(e.h3,{id:"option-2-score-based-\uc810\uc218-\ube44\ub840",children:"Option 2: Score-Based (\uc810\uc218 \ube44\ub840)"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"func (c *constructor) scoreBasedWeight(ranked []contracts.RankedStock) map[string]float64 {\n    available := 1.0 - c.config.CashReserve\n\n    // \uc810\uc218 \ud569\uacc4\n    var totalScore float64\n    for _, s := range ranked {\n        totalScore += s.TotalScore\n    }\n\n    weights := make(map[string]float64)\n    for _, s := range ranked {\n        weights[s.Code] = (s.TotalScore / totalScore) * available\n    }\n    return weights\n}\n"})}),"\n",(0,i.jsx)(e.h3,{id:"option-3-risk-parity-\ub9ac\uc2a4\ud06c-\ud328\ub9ac\ud2f0",children:"Option 3: Risk Parity (\ub9ac\uc2a4\ud06c \ud328\ub9ac\ud2f0)"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"func (c *constructor) riskParityWeight(ranked []contracts.RankedStock) map[string]float64 {\n    // \ubcc0\ub3d9\uc131 \uc5ed\uc218 \ube44\ub840\n    available := 1.0 - c.config.CashReserve\n\n    var totalInvVol float64\n    for _, s := range ranked {\n        vol := c.getVolatility(s.Code)\n        totalInvVol += 1.0 / vol\n    }\n\n    weights := make(map[string]float64)\n    for _, s := range ranked {\n        vol := c.getVolatility(s.Code)\n        weights[s.Code] = (1.0 / vol / totalInvVol) * available\n    }\n    return weights\n}\n"})}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"\uc81c\uc57d\uc870\uac74",children:"\uc81c\uc57d\uc870\uac74"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"// internal/portfolio/constraints.go\n\ntype Constraints struct {\n    MaxSectorWeight float64            // \uc139\ud130\ub2f9 \ucd5c\ub300 \ube44\uc911\n    MaxWeight       float64            // \uc885\ubaa9\ub2f9 \ucd5c\ub300 \ube44\uc911\n    MinWeight       float64            // \uc885\ubaa9\ub2f9 \ucd5c\uc18c \ube44\uc911\n    BlackList       []string           // \ub9e4\ub9e4 \uae08\uc9c0 \uc885\ubaa9\n}\n\nfunc (c *constructor) applyConstraints(weights map[string]float64) map[string]float64 {\n    result := make(map[string]float64)\n\n    for code, weight := range weights {\n        // Max weight \uc81c\ud55c\n        if weight > c.constraints.MaxWeight {\n            weight = c.constraints.MaxWeight\n        }\n\n        // Min weight \uc81c\ud55c\n        if weight < c.constraints.MinWeight {\n            continue // \uc81c\uc678\n        }\n\n        // \ube14\ub799\ub9ac\uc2a4\ud2b8 \uccb4\ud06c\n        if c.isBlackListed(code) {\n            continue\n        }\n\n        result[code] = weight\n    }\n\n    // \ube44\uc911 \ud569\uacc4 \uc7ac\uc870\uc815\n    return c.normalizeWeights(result)\n}\n"})}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"\uc124\uc815-\uc608\uc2dc-yaml",children:"\uc124\uc815 \uc608\uc2dc (YAML)"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:'# config/portfolio.yaml\n\nportfolio:\n  max_positions: 20\n  max_weight: 0.15       # 15%\n  min_weight: 0.03       # 3%\n  cash_reserve: 0.05     # 5%\n  turnover_limit: 0.30   # 30%\n\n  weighting: "score_based"  # equal, score_based, risk_parity\n\n  constraints:\n    max_sector_weight: 0.30   # \uc139\ud130\ub2f9 30%\n    black_list: []\n'})}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"db-\uc2a4\ud0a4\ub9c8",children:"DB \uc2a4\ud0a4\ub9c8"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- portfolio.targets: \ubaa9\ud45c \ud3ec\ud2b8\ud3f4\ub9ac\uc624\nCREATE TABLE portfolio.targets (\n    id          SERIAL PRIMARY KEY,\n    date        DATE NOT NULL,\n    positions   JSONB NOT NULL,     -- TargetPosition[]\n    cash        DECIMAL(5,4),\n    created_at  TIMESTAMPTZ DEFAULT NOW()\n);\n\n-- portfolio.holdings: \ud604\uc7ac \ubcf4\uc720\nCREATE TABLE portfolio.holdings (\n    id          SERIAL PRIMARY KEY,\n    code        VARCHAR(10) NOT NULL,\n    name        VARCHAR(100),\n    quantity    INT NOT NULL,\n    avg_price   DECIMAL(12,2),\n    weight      DECIMAL(5,4),\n    updated_at  TIMESTAMPTZ DEFAULT NOW()\n);\n"})}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Prev"}),": ",(0,i.jsx)(e.a,{href:"/aegis-v13/docs/guide/backend/selection-layer",children:"Selection Layer"}),"\n",(0,i.jsx)(e.strong,{children:"Next"}),": ",(0,i.jsx)(e.a,{href:"/aegis-v13/docs/guide/backend/execution-layer",children:"Execution Layer"})]})]})}function g(n={}){const{wrapper:e}={...(0,r.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(d,{...n})}):d(n)}},8453(n,e,t){t.d(e,{R:()=>a,x:()=>s});var o=t(6540);const i={},r=o.createContext(i);function a(n){const e=o.useContext(r);return o.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function s(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:a(n.components),o.createElement(r.Provider,{value:e},n.children)}}}]);