"use strict";(globalThis.webpackChunkdocs_site=globalThis.webpackChunkdocs_site||[]).push([[627],{2540(n,e,t){t.r(e),t.d(e,{assets:()=>i,contentTitle:()=>r,default:()=>g,frontMatter:()=>c,metadata:()=>l,toc:()=>o});const l=JSON.parse('{"id":"guide/backend/signals-layer","title":"Signals Layer","description":"S2 \uc2dc\uadf8\ub110 \uc0dd\uc131","source":"@site/docs/guide/backend/signals-layer.md","sourceDirName":"guide/backend","slug":"/guide/backend/signals-layer","permalink":"/aegis-v13/docs/guide/backend/signals-layer","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"title":"Signals Layer","description":"S2 \uc2dc\uadf8\ub110 \uc0dd\uc131"},"sidebar":"guideSidebar","previous":{"title":"Data Layer","permalink":"/aegis-v13/docs/guide/backend/data-layer"},"next":{"title":"Selection Layer","permalink":"/aegis-v13/docs/guide/backend/selection-layer"}}');var a=t(4848),s=t(8453);const c={sidebar_position:3,title:"Signals Layer",description:"S2 \uc2dc\uadf8\ub110 \uc0dd\uc131"},r="Signals Layer",i={},o=[{value:"\ucc45\uc784",id:"\ucc45\uc784",level:2},{value:"\ud3f4\ub354 \uad6c\uc870",id:"\ud3f4\ub354-\uad6c\uc870",level:2},{value:"Signal Builder",id:"signal-builder",level:2},{value:"\uc778\ud130\ud398\uc774\uc2a4",id:"\uc778\ud130\ud398\uc774\uc2a4",level:3},{value:"\uad6c\ud604",id:"\uad6c\ud604",level:3},{value:"Momentum Signal",id:"momentum-signal",level:2},{value:"Value Signal",id:"value-signal",level:2},{value:"Flow Signal (\uc218\uae09)",id:"flow-signal-\uc218\uae09",level:2},{value:"\uc218\uae09 \uc810\uc218 \ud574\uc11d",id:"\uc218\uae09-\uc810\uc218-\ud574\uc11d",level:3},{value:"Event Signal",id:"event-signal",level:2},{value:"\uc774\ubca4\ud2b8 \ud0c0\uc785\ubcc4 \uc810\uc218",id:"\uc774\ubca4\ud2b8-\ud0c0\uc785\ubcc4-\uc810\uc218",level:2},{value:"DB \uc2a4\ud0a4\ub9c8",id:"db-\uc2a4\ud0a4\ub9c8",level:2}];function d(n){const e={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,s.R)(),...n.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(e.header,{children:(0,a.jsx)(e.h1,{id:"signals-layer",children:"Signals Layer"})}),"\n",(0,a.jsxs)(e.blockquote,{children:["\n",(0,a.jsx)(e.p,{children:"S2: \uc2dc\uadf8\ub110 \uc0dd\uc131"}),"\n"]}),"\n",(0,a.jsx)(e.hr,{}),"\n",(0,a.jsx)(e.h2,{id:"\ucc45\uc784",children:"\ucc45\uc784"}),"\n",(0,a.jsxs)(e.p,{children:["Universe\uc5d0 \ud3ec\ud568\ub41c \uc885\ubaa9\ub4e4\uc758 ",(0,a.jsx)(e.strong,{children:"\ud329\ud130/\uc774\ubca4\ud2b8 \uc2dc\uadf8\ub110"}),"\uc744 \uacc4\uc0b0"]}),"\n",(0,a.jsx)(e.hr,{}),"\n",(0,a.jsx)(e.h2,{id:"\ud3f4\ub354-\uad6c\uc870",children:"\ud3f4\ub354 \uad6c\uc870"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:"internal/signals/\n\u251c\u2500\u2500 builder.go      # SignalBuilder \uad6c\ud604 (\uc870\ud569)\n\u251c\u2500\u2500 momentum.go     # \ubaa8\uba58\ud140 \uc2dc\uadf8\ub110\n\u251c\u2500\u2500 technical.go    # \uae30\uc220\uc801 \uc2dc\uadf8\ub110 (RSI, MACD)\n\u251c\u2500\u2500 value.go        # \uac00\uce58 \uc2dc\uadf8\ub110\n\u251c\u2500\u2500 quality.go      # \ud004\ub9ac\ud2f0 \uc2dc\uadf8\ub110\n\u251c\u2500\u2500 flow.go         # \uc218\uae09 \uc2dc\uadf8\ub110 \u2b50\n\u251c\u2500\u2500 event.go        # \uc774\ubca4\ud2b8 \uc2dc\uadf8\ub110\n\u2514\u2500\u2500 repository.go   # DB \uc811\uadfc\n"})}),"\n",(0,a.jsx)(e.hr,{}),"\n",(0,a.jsx)(e.h2,{id:"signal-builder",children:"Signal Builder"}),"\n",(0,a.jsx)(e.h3,{id:"\uc778\ud130\ud398\uc774\uc2a4",children:"\uc778\ud130\ud398\uc774\uc2a4"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-go",children:"type SignalBuilder interface {\n    Build(ctx context.Context, universe *Universe) (*SignalSet, error)\n}\n"})}),"\n",(0,a.jsx)(e.h3,{id:"\uad6c\ud604",children:"\uad6c\ud604"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-go",children:"// internal/signals/builder.go\n\ntype signalBuilder struct {\n    momentum  MomentumCalculator\n    technical TechnicalCalculator\n    value     ValueCalculator\n    quality   QualityCalculator\n    flow      FlowCalculator      // \uc218\uae09 \u2b50\n    event     EventCalculator\n    db        *pgxpool.Pool\n}\n\nfunc (b *signalBuilder) Build(ctx context.Context, universe *contracts.Universe) (*contracts.SignalSet, error) {\n    signalSet := &contracts.SignalSet{\n        Date:    universe.Date,\n        Signals: make(map[string]*contracts.StockSignals),\n    }\n\n    for _, code := range universe.Stocks {\n        signal := &contracts.StockSignals{\n            Code: code,\n        }\n\n        // \uac01 \uc2dc\uadf8\ub110 \uacc4\uc0b0\n        signal.Momentum = b.momentum.Calculate(ctx, code)\n        signal.Technical = b.technical.Calculate(ctx, code)\n        signal.Value = b.value.Calculate(ctx, code)\n        signal.Quality = b.quality.Calculate(ctx, code)\n        signal.Flow = b.flow.Calculate(ctx, code)  // \uc218\uae09 \u2b50\n\n        // \uc774\ubca4\ud2b8 \uc2dc\uadf8\ub110\n        signal.Events = b.event.GetEvents(ctx, code)\n        signal.Event = b.event.CalculateScore(signal.Events)\n\n        // \uc0c1\uc138 \ub370\uc774\ud130\n        signal.Details = b.buildDetails(ctx, code)\n\n        signal.UpdatedAt = time.Now()\n        signalSet.Signals[code] = signal\n    }\n\n    return signalSet, nil\n}\n"})}),"\n",(0,a.jsx)(e.hr,{}),"\n",(0,a.jsx)(e.h2,{id:"momentum-signal",children:"Momentum Signal"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-go",children:"// internal/signals/momentum.go\n\ntype MomentumCalculator interface {\n    Calculate(ctx context.Context, code string) float64\n}\n\ntype momentumCalculator struct {\n    db *pgxpool.Pool\n}\n\nfunc (c *momentumCalculator) Calculate(ctx context.Context, code string) float64 {\n    // 1. \uc218\uc775\ub960 \uacc4\uc0b0\n    ret1m := c.getReturn(ctx, code, 20)   // 1\uac1c\uc6d4\n    ret3m := c.getReturn(ctx, code, 60)   // 3\uac1c\uc6d4\n    ret6m := c.getReturn(ctx, code, 120)  // 6\uac1c\uc6d4\n\n    // 2. \uac00\uc911 \ud3c9\uade0 (\ucd5c\uadfc \ube44\uc911 \ub192\uac8c)\n    score := ret1m*0.5 + ret3m*0.3 + ret6m*0.2\n\n    // 3. Z-score \uc815\uaddc\ud654 (-3 ~ +3 \ubc94\uc704)\n    return c.normalize(score)\n}\n"})}),"\n",(0,a.jsx)(e.hr,{}),"\n",(0,a.jsx)(e.h2,{id:"value-signal",children:"Value Signal"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-go",children:"// internal/signals/value.go\n\ntype ValueCalculator interface {\n    Calculate(ctx context.Context, code string) float64\n}\n\nfunc (c *valueCalculator) Calculate(ctx context.Context, code string) float64 {\n    fundamental := c.getFundamental(ctx, code)\n\n    // PER \uc810\uc218 (\ub0ae\uc744\uc218\ub85d \uc88b\uc74c, \uc5ed\uc218)\n    perScore := c.invertAndNormalize(fundamental.PER)\n\n    // PBR \uc810\uc218 (\ub0ae\uc744\uc218\ub85d \uc88b\uc74c, \uc5ed\uc218)\n    pbrScore := c.invertAndNormalize(fundamental.PBR)\n\n    // PSR \uc810\uc218\n    psrScore := c.invertAndNormalize(fundamental.PSR)\n\n    // \uac00\uc911 \ud3c9\uade0\n    return perScore*0.4 + pbrScore*0.4 + psrScore*0.2\n}\n"})}),"\n",(0,a.jsx)(e.hr,{}),"\n",(0,a.jsx)(e.h2,{id:"flow-signal-\uc218\uae09",children:"Flow Signal (\uc218\uae09)"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-go",children:"// internal/signals/flow.go\n\ntype FlowCalculator interface {\n    Calculate(ctx context.Context, code string) float64\n}\n\ntype flowCalculator struct {\n    db *pgxpool.Pool\n}\n\nfunc (c *flowCalculator) Calculate(ctx context.Context, code string) float64 {\n    // 1. \uc678\uad6d\uc778/\uae30\uad00 \uc21c\ub9e4\uc218 \ub370\uc774\ud130 \uc870\ud68c\n    flow := c.getInvestorFlow(ctx, code)\n\n    // 2. 5\uc77c/20\uc77c \ub204\uc801 \uc21c\ub9e4\uc218\n    foreignScore := c.normalizeFlow(flow.ForeignNet5D, flow.ForeignNet20D)\n    instScore := c.normalizeFlow(flow.InstNet5D, flow.InstNet20D)\n\n    // 3. \uac00\uc911 \ud569\uc0b0 (\uc678\uad6d\uc778 60%, \uae30\uad00 40%)\n    return foreignScore*0.6 + instScore*0.4\n}\n\nfunc (c *flowCalculator) getInvestorFlow(ctx context.Context, code string) *FlowData {\n    query := `\n        SELECT\n            SUM(CASE WHEN date > NOW() - INTERVAL '5 days' THEN foreign_net ELSE 0 END) as foreign_5d,\n            SUM(CASE WHEN date > NOW() - INTERVAL '20 days' THEN foreign_net ELSE 0 END) as foreign_20d,\n            SUM(CASE WHEN date > NOW() - INTERVAL '5 days' THEN inst_net ELSE 0 END) as inst_5d,\n            SUM(CASE WHEN date > NOW() - INTERVAL '20 days' THEN inst_net ELSE 0 END) as inst_20d\n        FROM data.investor_flow\n        WHERE stock_code = $1 AND date > NOW() - INTERVAL '20 days'\n    `\n    // ...\n}\n\nfunc (c *flowCalculator) normalizeFlow(short, long int64) float64 {\n    // \ub2e8\uae30 \ucd94\uc138 (5\uc77c)\uc640 \uc7a5\uae30 \ucd94\uc138 (20\uc77c) \uc870\ud569\n    // Z-score \uc815\uaddc\ud654 \ud6c4 -1.0 ~ 1.0 \ubc94\uc704\ub85c \ubcc0\ud658\n    shortScore := c.zScore(short)\n    longScore := c.zScore(long)\n\n    return shortScore*0.7 + longScore*0.3\n}\n"})}),"\n",(0,a.jsx)(e.h3,{id:"\uc218\uae09-\uc810\uc218-\ud574\uc11d",children:"\uc218\uae09 \uc810\uc218 \ud574\uc11d"}),"\n",(0,a.jsxs)(e.table,{children:[(0,a.jsx)(e.thead,{children:(0,a.jsxs)(e.tr,{children:[(0,a.jsx)(e.th,{children:"\uc810\uc218 \ubc94\uc704"}),(0,a.jsx)(e.th,{children:"\ud574\uc11d"})]})}),(0,a.jsxs)(e.tbody,{children:[(0,a.jsxs)(e.tr,{children:[(0,a.jsx)(e.td,{children:"0.5 ~ 1.0"}),(0,a.jsx)(e.td,{children:"\uac15\ud55c \ub9e4\uc218\uc138 (\uc678\uad6d\uc778+\uae30\uad00 \ub3d9\uc2dc \uc21c\ub9e4\uc218)"})]}),(0,a.jsxs)(e.tr,{children:[(0,a.jsx)(e.td,{children:"0.0 ~ 0.5"}),(0,a.jsx)(e.td,{children:"\uc57d\ud55c \ub9e4\uc218\uc138"})]}),(0,a.jsxs)(e.tr,{children:[(0,a.jsx)(e.td,{children:"-0.5 ~ 0.0"}),(0,a.jsx)(e.td,{children:"\uc57d\ud55c \ub9e4\ub3c4\uc138"})]}),(0,a.jsxs)(e.tr,{children:[(0,a.jsx)(e.td,{children:"-1.0 ~ -0.5"}),(0,a.jsx)(e.td,{children:"\uac15\ud55c \ub9e4\ub3c4\uc138 (\uc678\uad6d\uc778+\uae30\uad00 \ub3d9\uc2dc \uc21c\ub9e4\ub3c4)"})]})]})]}),"\n",(0,a.jsx)(e.hr,{}),"\n",(0,a.jsx)(e.h2,{id:"event-signal",children:"Event Signal"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-go",children:'// internal/signals/event.go\n\ntype EventCalculator interface {\n    GetEvents(ctx context.Context, code string) []contracts.EventSignal\n    CalculateScore(events []contracts.EventSignal) float64\n}\n\nfunc (c *eventCalculator) GetEvents(ctx context.Context, code string) []contracts.EventSignal {\n    events := make([]contracts.EventSignal, 0)\n\n    // 1. \uacf5\uc2dc \uc774\ubca4\ud2b8\n    disclosures := c.getDisclosures(ctx, code, 30) // \ucd5c\uadfc 30\uc77c\n    for _, d := range disclosures {\n        events = append(events, contracts.EventSignal{\n            Type:      d.Type,\n            Score:     c.scoreDisclosure(d),\n            Source:    "DART",\n            Timestamp: d.Date,\n        })\n    }\n\n    // 2. \ub274\uc2a4 \uc774\ubca4\ud2b8\n    news := c.getNews(ctx, code, 7) // \ucd5c\uadfc 7\uc77c\n    for _, n := range news {\n        events = append(events, contracts.EventSignal{\n            Type:      "NEWS",\n            Score:     n.Sentiment,\n            Source:    n.Source,\n            Timestamp: n.Date,\n        })\n    }\n\n    return events\n}\n\nfunc (c *eventCalculator) CalculateScore(events []contracts.EventSignal) float64 {\n    if len(events) == 0 {\n        return 0\n    }\n\n    var totalScore float64\n    var totalWeight float64\n\n    for _, e := range events {\n        // \uc2dc\uac04 \uac10\uc1e0 (\ucd5c\uadfc \uc774\ubca4\ud2b8 \uac00\uc911\uce58 \ub192\uc74c)\n        daysSince := time.Since(e.Timestamp).Hours() / 24\n        weight := math.Exp(-daysSince / 7) // 7\uc77c \ubc18\uac10\uae30\n\n        totalScore += e.Score * weight\n        totalWeight += weight\n    }\n\n    return totalScore / totalWeight\n}\n'})}),"\n",(0,a.jsx)(e.hr,{}),"\n",(0,a.jsx)(e.h2,{id:"\uc774\ubca4\ud2b8-\ud0c0\uc785\ubcc4-\uc810\uc218",children:"\uc774\ubca4\ud2b8 \ud0c0\uc785\ubcc4 \uc810\uc218"}),"\n",(0,a.jsxs)(e.table,{children:[(0,a.jsx)(e.thead,{children:(0,a.jsxs)(e.tr,{children:[(0,a.jsx)(e.th,{children:"\uc774\ubca4\ud2b8"}),(0,a.jsx)(e.th,{children:"\uae30\ubcf8 \uc810\uc218"}),(0,a.jsx)(e.th,{children:"\uc124\uba85"})]})}),(0,a.jsxs)(e.tbody,{children:[(0,a.jsxs)(e.tr,{children:[(0,a.jsx)(e.td,{children:"\uc790\uc0ac\uc8fc\ub9e4\uc785"}),(0,a.jsx)(e.td,{children:"+2.0"}),(0,a.jsx)(e.td,{children:"\uac15\ud55c \uae0d\uc815"})]}),(0,a.jsxs)(e.tr,{children:[(0,a.jsx)(e.td,{children:"\ubc30\ub2f9 \uc99d\uac00"}),(0,a.jsx)(e.td,{children:"+1.5"}),(0,a.jsx)(e.td,{children:"\uae0d\uc815"})]}),(0,a.jsxs)(e.tr,{children:[(0,a.jsx)(e.td,{children:"\uc2e4\uc801 \uc11c\ud504\ub77c\uc774\uc988"}),(0,a.jsx)(e.td,{children:"+1.0 ~ +2.0"}),(0,a.jsx)(e.td,{children:"\uc815\ub3c4\uc5d0 \ub530\ub77c"})]}),(0,a.jsxs)(e.tr,{children:[(0,a.jsx)(e.td,{children:"\ub300\uaddc\ubaa8 \uacc4\uc57d"}),(0,a.jsx)(e.td,{children:"+1.0"}),(0,a.jsx)(e.td,{children:"\uae0d\uc815"})]}),(0,a.jsxs)(e.tr,{children:[(0,a.jsx)(e.td,{children:"\uc720\uc0c1\uc99d\uc790"}),(0,a.jsx)(e.td,{children:"-1.0"}),(0,a.jsx)(e.td,{children:"\ubd80\uc815"})]}),(0,a.jsxs)(e.tr,{children:[(0,a.jsx)(e.td,{children:"CB/BW \ubc1c\ud589"}),(0,a.jsx)(e.td,{children:"-0.5"}),(0,a.jsx)(e.td,{children:"\uc57d\ud55c \ubd80\uc815"})]}),(0,a.jsxs)(e.tr,{children:[(0,a.jsx)(e.td,{children:"\ud6a1\ub839/\ubc30\uc784"}),(0,a.jsx)(e.td,{children:"-2.0"}),(0,a.jsx)(e.td,{children:"\uac15\ud55c \ubd80\uc815"})]})]})]}),"\n",(0,a.jsx)(e.hr,{}),"\n",(0,a.jsx)(e.h2,{id:"db-\uc2a4\ud0a4\ub9c8",children:"DB \uc2a4\ud0a4\ub9c8"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:"-- signals.factor_scores: \ud329\ud130 \uc810\uc218\nCREATE TABLE signals.factor_scores (\n    id          SERIAL PRIMARY KEY,\n    date        DATE NOT NULL,\n    code        VARCHAR(10) NOT NULL,\n    momentum    DECIMAL(8,4),\n    technical   DECIMAL(8,4),\n    value       DECIMAL(8,4),\n    quality     DECIMAL(8,4),\n    flow        DECIMAL(8,4),       -- \uc218\uae09 \uc2dc\uadf8\ub110 \u2b50\n    event       DECIMAL(8,4),\n    created_at  TIMESTAMPTZ DEFAULT NOW(),\n    UNIQUE(date, code)\n);\n\n-- signals.flow_details: \uc218\uae09 \uc0c1\uc138 (5D/20D \ub204\uc801) \u2b50\nCREATE TABLE signals.flow_details (\n    id              SERIAL PRIMARY KEY,\n    date            DATE NOT NULL,\n    stock_code      VARCHAR(10) NOT NULL,\n    foreign_net_5d  BIGINT,         -- \uc678\uad6d\uc778 5\uc77c \uc21c\ub9e4\uc218\n    foreign_net_20d BIGINT,         -- \uc678\uad6d\uc778 20\uc77c \uc21c\ub9e4\uc218\n    inst_net_5d     BIGINT,         -- \uae30\uad00 5\uc77c \uc21c\ub9e4\uc218\n    inst_net_20d    BIGINT,         -- \uae30\uad00 20\uc77c \uc21c\ub9e4\uc218\n    flow_score      DECIMAL(8,4),   -- \uc885\ud569 \uc218\uae09 \uc810\uc218\n    created_at      TIMESTAMPTZ DEFAULT NOW(),\n    UNIQUE(date, stock_code)\n);\n\n-- signals.events: \uc774\ubca4\ud2b8 \ub85c\uadf8\nCREATE TABLE signals.events (\n    id          SERIAL PRIMARY KEY,\n    code        VARCHAR(10) NOT NULL,\n    event_type  VARCHAR(50) NOT NULL,\n    score       DECIMAL(5,2),\n    source      VARCHAR(20),\n    event_date  DATE NOT NULL,\n    raw_data    JSONB,\n    created_at  TIMESTAMPTZ DEFAULT NOW()\n);\n\nCREATE INDEX idx_factor_scores_date ON signals.factor_scores(date, code);\nCREATE INDEX idx_flow_details_date ON signals.flow_details(date, stock_code);\nCREATE INDEX idx_events_code_date ON signals.events(code, event_date);\n"})}),"\n",(0,a.jsx)(e.hr,{}),"\n",(0,a.jsxs)(e.p,{children:[(0,a.jsx)(e.strong,{children:"Prev"}),": ",(0,a.jsx)(e.a,{href:"/aegis-v13/docs/guide/backend/data-layer",children:"Data Layer"}),"\n",(0,a.jsx)(e.strong,{children:"Next"}),": ",(0,a.jsx)(e.a,{href:"/aegis-v13/docs/guide/backend/selection-layer",children:"Selection Layer"})]})]})}function g(n={}){const{wrapper:e}={...(0,s.R)(),...n.components};return e?(0,a.jsx)(e,{...n,children:(0,a.jsx)(d,{...n})}):d(n)}},8453(n,e,t){t.d(e,{R:()=>c,x:()=>r});var l=t(6540);const a={},s=l.createContext(a);function c(n){const e=l.useContext(s);return l.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function r(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(a):n.components||a:c(n.components),l.createElement(s.Provider,{value:e},n.children)}}}]);