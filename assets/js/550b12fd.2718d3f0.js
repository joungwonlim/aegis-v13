"use strict";(globalThis.webpackChunkdocs_site=globalThis.webpackChunkdocs_site||[]).push([[9976],{7643(n,t,e){e.r(t),e.d(t,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>s,metadata:()=>o,toc:()=>l});const o=JSON.parse('{"id":"guide/backend/portfolio-layer","title":"Portfolio Layer","description":"S5 \ud3ec\ud2b8\ud3f4\ub9ac\uc624 \uad6c\uc131","source":"@site/docs/guide/backend/portfolio-layer.md","sourceDirName":"guide/backend","slug":"/guide/backend/portfolio-layer","permalink":"/aegis-v13/docs/guide/backend/portfolio-layer","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5,"title":"Portfolio Layer","description":"S5 \ud3ec\ud2b8\ud3f4\ub9ac\uc624 \uad6c\uc131"},"sidebar":"guideSidebar","previous":{"title":"Selection Layer","permalink":"/aegis-v13/docs/guide/backend/selection-layer"},"next":{"title":"Execution Layer","permalink":"/aegis-v13/docs/guide/backend/execution-layer"}}');var r=e(4848),i=e(8453);const s={sidebar_position:5,title:"Portfolio Layer",description:"S5 \ud3ec\ud2b8\ud3f4\ub9ac\uc624 \uad6c\uc131"},a="Portfolio Layer",c={},l=[{value:"\ucc45\uc784",id:"\ucc45\uc784",level:2},{value:"\uad6c\ud604 \uc0c1\ud0dc (2026-01-11)",id:"\uad6c\ud604-\uc0c1\ud0dc-2026-01-11",level:2},{value:"YAML SSOT \uc124\uc815\uac12",id:"yaml-ssot-\uc124\uc815\uac12",level:3},{value:"\ud504\ub85c\uc138\uc2a4 \ud750\ub984",id:"\ud504\ub85c\uc138\uc2a4-\ud750\ub984",level:2},{value:"\ud3f4\ub354 \uad6c\uc870",id:"\ud3f4\ub354-\uad6c\uc870",level:2},{value:"Portfolio Constructor",id:"portfolio-constructor",level:2},{value:"\uc778\ud130\ud398\uc774\uc2a4",id:"\uc778\ud130\ud398\uc774\uc2a4",level:3},{value:"\uad6c\ud604",id:"\uad6c\ud604",level:3},{value:"Weight \uacc4\uc0b0 \ubc29\uc2dd",id:"weight-\uacc4\uc0b0-\ubc29\uc2dd",level:2},{value:"\u2b50 Option 1: Tiered Weighting (\uae30\ubcf8\uac12)",id:"-option-1-tiered-weighting-\uae30\ubcf8\uac12",level:3},{value:"Option 2: Equal Weight (\ub3d9\uc77c \ube44\uc911)",id:"option-2-equal-weight-\ub3d9\uc77c-\ube44\uc911",level:3},{value:"Option 3: Score-Based (\uc810\uc218 \ube44\ub840)",id:"option-3-score-based-\uc810\uc218-\ube44\ub840",level:3},{value:"Option 4: Risk Parity (\ub9ac\uc2a4\ud06c \ud328\ub9ac\ud2f0)",id:"option-4-risk-parity-\ub9ac\uc2a4\ud06c-\ud328\ub9ac\ud2f0",level:3},{value:"\uc81c\uc57d\uc870\uac74",id:"\uc81c\uc57d\uc870\uac74",level:2},{value:"Portfolio Repository",id:"portfolio-repository",level:2},{value:"DB \uc2a4\ud0a4\ub9c8",id:"db-\uc2a4\ud0a4\ub9c8",level:2}];function d(n){const t={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,i.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"portfolio-layer",children:"Portfolio Layer"})}),"\n",(0,r.jsxs)(t.blockquote,{children:["\n",(0,r.jsx)(t.p,{children:"S5: \ud3ec\ud2b8\ud3f4\ub9ac\uc624 \uad6c\uc131"}),"\n"]}),"\n",(0,r.jsx)(t.hr,{}),"\n",(0,r.jsx)(t.h2,{id:"\ucc45\uc784",children:"\ucc45\uc784"}),"\n",(0,r.jsxs)(t.p,{children:["\ub7ad\ud0b9 \uacb0\uacfc\ub97c \ubc14\ud0d5\uc73c\ub85c ",(0,r.jsx)(t.strong,{children:"\ubaa9\ud45c \ud3ec\ud2b8\ud3f4\ub9ac\uc624"})," \uc0b0\ucd9c"]}),"\n",(0,r.jsx)(t.hr,{}),"\n",(0,r.jsx)(t.h2,{id:"\uad6c\ud604-\uc0c1\ud0dc-2026-01-11",children:"\uad6c\ud604 \uc0c1\ud0dc (2026-01-11)"}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"\ucef4\ud3ec\ub10c\ud2b8"}),(0,r.jsx)(t.th,{children:"\uc0c1\ud0dc"}),(0,r.jsx)(t.th,{children:"\ud30c\uc77c"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.strong,{children:"Constructor"})}),(0,r.jsx)(t.td,{children:"\u2705 \uc644\ub8cc"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"internal/portfolio/constructor.go"})})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.strong,{children:"Tiered Weighting"})}),(0,r.jsx)(t.td,{children:"\u2705 \uc644\ub8cc"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"internal/portfolio/constructor.go"})})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.strong,{children:"Constraints"})}),(0,r.jsx)(t.td,{children:"\u2705 \uc644\ub8cc"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"internal/portfolio/constraints.go"})})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.strong,{children:"Repository"})}),(0,r.jsx)(t.td,{children:"\u2705 \uc644\ub8cc"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"internal/portfolio/repository.go"})})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"Rebalancer"}),(0,r.jsx)(t.td,{children:"\u23f3 TODO"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"internal/portfolio/rebalancer.go"})})]})]})]}),"\n",(0,r.jsx)(t.admonition,{title:"YAML SSOT",type:"tip",children:(0,r.jsxs)(t.p,{children:["\ud3ec\ud2b8\ud3f4\ub9ac\uc624 \uc81c\uc57d\uc870\uac74\uacfc \ube44\uc911 \ubc30\ubd84\uc740 ",(0,r.jsx)(t.code,{children:"backend/config/strategy/korea_equity_v13.yaml"}),"\uc758 ",(0,r.jsx)(t.code,{children:"portfolio"})," \uc139\uc158\uc5d0\uc11c \uad00\ub9ac\ub429\ub2c8\ub2e4."]})}),"\n",(0,r.jsx)(t.h3,{id:"yaml-ssot-\uc124\uc815\uac12",children:"YAML SSOT \uc124\uc815\uac12"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:'portfolio:\n  holdings:\n    target: 20      # \ubaa9\ud45c \uc885\ubaa9 \uc218\n    min: 15         # \ucd5c\uc18c \uc885\ubaa9 \uc218\n    max: 20         # \ucd5c\ub300 \uc885\ubaa9 \uc218\n\n  allocation:\n    cash_target_pct: 0.10        # \ud604\uae08 10%\n    position_min_pct: 0.04       # \uc885\ubaa9\ub2f9 \ucd5c\uc18c 4%\n    position_max_pct: 0.10       # \uc885\ubaa9\ub2f9 \ucd5c\ub300 10%\n    sector_max_pct: 0.25         # \uc139\ud130\ub2f9 \ucd5c\ub300 25%\n    turnover_daily_max_pct: 0.20 # \uc77c \ud68c\uc804\uc728 \ucd5c\ub300 20%\n\n  weighting:\n    method: "TIERED"  # \u2b50 Tiered Weighting\n    tiers:\n      - { count: 5,  weight_each_pct: 0.05 }   # 1-5\uc704: 5%\n      - { count: 10, weight_each_pct: 0.045 }  # 6-15\uc704: 4.5%\n      - { count: 5,  weight_each_pct: 0.04 }   # 16-20\uc704: 4%\n    # \ud569\uacc4: 5\xd75% + 10\xd74.5% + 5\xd74% = 25% + 45% + 20% = 90%\n    # \uc8fc\uc2dd 90% + \ud604\uae08 10% = 100%\n'})}),"\n",(0,r.jsx)(t.hr,{}),"\n",(0,r.jsx)(t.h2,{id:"\ud504\ub85c\uc138\uc2a4-\ud750\ub984",children:"\ud504\ub85c\uc138\uc2a4 \ud750\ub984"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                      Portfolio Construction Pipeline                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                    \u2502\n                                    \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                              \uc785\ub825: RankedStock[]                             \u2502\n\u2502                           (S4\uc5d0\uc11c \uc810\uc218\uc21c \uc815\ub82c\ub41c \uc885\ubaa9)                          \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                    \u2502\n        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n        \u25bc                           \u25bc                           \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510       \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510       \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  1. Top-N \uc120\uc815    \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502  2. Tier \ube44\uc911     \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502  3. \uc81c\uc57d\uc870\uac74 \uc801\uc6a9  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524       \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524       \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 target: 20\uc885\ubaa9    \u2502       \u2502 Tier 1: 5\uc885\ubaa9\xd75%  \u2502       \u2502 position_max: 10% \u2502\n\u2502 min: 15\uc885\ubaa9       \u2502       \u2502 Tier 2: 10\uc885\ubaa9\xd74.5%\u2502       \u2502 position_min: 4%  \u2502\n\u2502 max: 20\uc885\ubaa9       \u2502       \u2502 Tier 3: 5\uc885\ubaa9\xd74%  \u2502       \u2502 sector_max: 25%   \u2502\n\u2502                   \u2502       \u2502 \u2192 \ud569\uacc4: 90%       \u2502       \u2502 cash: 10%         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                                                \u2502\n                                                                \u25bc\n                                                \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                                                \u2502   \ucd9c\ub825: TargetPortfolio    \u2502\n                                                \u2502  (\uc885\ubaa9, \ube44\uc911, \ub9e4\ub9e4\uc561\uc158)     \u2502\n                                                \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,r.jsx)(t.hr,{}),"\n",(0,r.jsx)(t.h2,{id:"\ud3f4\ub354-\uad6c\uc870",children:"\ud3f4\ub354 \uad6c\uc870"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"internal/portfolio/\n\u251c\u2500\u2500 constructor.go   # Portfolio Constructor \uad6c\ud604\n\u251c\u2500\u2500 constraints.go   # \uc81c\uc57d\uc870\uac74 \uac80\uc99d\n\u2514\u2500\u2500 repository.go    # DB \uc811\uadfc (SSOT)\n"})}),"\n",(0,r.jsxs)(t.blockquote,{children:["\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.code,{children:"rebalancer.go"}),"\ub294 \ud5a5\ud6c4 \uad6c\ud604 \uc608\uc815"]}),"\n"]}),"\n",(0,r.jsx)(t.hr,{}),"\n",(0,r.jsx)(t.h2,{id:"portfolio-constructor",children:"Portfolio Constructor"}),"\n",(0,r.jsx)(t.h3,{id:"\uc778\ud130\ud398\uc774\uc2a4",children:"\uc778\ud130\ud398\uc774\uc2a4"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-go",children:"type PortfolioConstructor interface {\n    // \u2b50 P0 \uc218\uc815: totalValue \ud30c\ub77c\ubbf8\ud130 \ucd94\uac00\n    // Portfolio\ub294 \ubaa9\ud45c \uae08\uc561(TargetValue)\ub9cc \uc0b0\ucd9c, Execution\uc774 \ud604\uc7ac\uac00\ub85c \uc218\ub7c9 \uacc4\uc0b0\n    Construct(ctx context.Context, ranked []RankedStock, totalValue int64) (*TargetPortfolio, error)\n}\n"})}),"\n",(0,r.jsx)(t.h3,{id:"\uad6c\ud604",children:"\uad6c\ud604"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-go",children:'// internal/portfolio/constructor.go\n\ntype Constructor struct {\n    config      PortfolioConfig\n    constraints Constraints\n    logger      *logger.Logger\n}\n\ntype PortfolioConfig struct {\n    MaxPositions  int     // \ucd5c\ub300 \uc885\ubaa9 \uc218\n    MaxWeight     float64 // \uc885\ubaa9\ub2f9 \ucd5c\ub300 \ube44\uc911 (0.0 ~ 1.0)\n    MinWeight     float64 // \uc885\ubaa9\ub2f9 \ucd5c\uc18c \ube44\uc911 (0.0 ~ 1.0)\n    CashReserve   float64 // \ud604\uae08 \ubcf4\uc720 \ube44\uc911 (0.0 ~ 1.0)\n    TurnoverLimit float64 // \ud68c\uc804\uc728 \uc81c\ud55c (0.0 ~ 1.0)\n    WeightingMode string  // "equal", "score_based", "risk_parity"\n}\n\n// \u2b50 P0 \uc218\uc815: totalValue \ud30c\ub77c\ubbf8\ud130\ub85c TargetValue \uacc4\uc0b0\nfunc (c *Constructor) Construct(ctx context.Context, ranked []contracts.RankedStock, totalValue int64) (*contracts.TargetPortfolio, error) {\n    target := &contracts.TargetPortfolio{\n        Date:      time.Now(),\n        Positions: make([]contracts.TargetPosition, 0),\n        Cash:      c.config.CashReserve,\n    }\n\n    // 1. Select top N stocks\n    topN := c.selectTopN(ranked)\n    if len(topN) == 0 {\n        c.logger.Warn("No stocks selected for portfolio")\n        return target, nil\n    }\n\n    // 2. Calculate weights\n    weights := c.calculateWeights(topN)\n\n    // 3. Apply constraints\n    weights = c.applyConstraints(weights)\n\n    // 4. Create target positions\n    for code, weight := range weights {\n        // Find stock info from ranked\n        var stock *contracts.RankedStock\n        for i := range topN {\n            if topN[i].Code == code {\n                stock = &topN[i]\n                break\n            }\n        }\n\n        if stock == nil {\n            continue\n        }\n\n        // \u2b50 TargetValue = Weight \xd7 TotalValue (\uc218\ub7c9\uc740 Execution\uc5d0\uc11c \uacc4\uc0b0)\n        targetValue := int64(float64(totalValue) * weight)\n\n        target.Positions = append(target.Positions, contracts.TargetPosition{\n            Code:        code,\n            Name:        stock.Name,\n            Weight:      weight,\n            TargetValue: targetValue, // \u2b50 \ubaa9\ud45c \uae08\uc561 (\uc6d0\ud654)\n            Action:      contracts.ActionBuy,\n            Reason:      c.getActionReason(stock),\n        })\n    }\n\n    c.logger.WithFields(map[string]interface{}{\n        "positions":    len(target.Positions),\n        "total_weight": target.TotalWeight(),\n        "cash":         target.Cash,\n    }).Info("Portfolio constructed")\n\n    return target, nil\n}\n\nfunc DefaultPortfolioConfig() PortfolioConfig {\n    return PortfolioConfig{\n        MaxPositions:  20,       // \ucd5c\ub300 20 \uc885\ubaa9\n        MinPositions:  15,       // \ucd5c\uc18c 15 \uc885\ubaa9\n        MaxWeight:     0.10,     // \ucd5c\ub300 10%\n        MinWeight:     0.04,     // \ucd5c\uc18c 4%\n        CashReserve:   0.10,     // 10% \ud604\uae08 \ubcf4\uc720\n        SectorMaxPct:  0.25,     // \uc139\ud130\ub2f9 \ucd5c\ub300 25%\n        TurnoverLimit: 0.20,     // \uc77c \ud68c\uc804\uc728 \uc81c\ud55c 20%\n        WeightingMode: "tiered", // \uae30\ubcf8: Tiered Weighting\n        Tiers:         DefaultTiers(),\n    }\n}\n'})}),"\n",(0,r.jsx)(t.hr,{}),"\n",(0,r.jsx)(t.h2,{id:"weight-\uacc4\uc0b0-\ubc29\uc2dd",children:"Weight \uacc4\uc0b0 \ubc29\uc2dd"}),"\n",(0,r.jsx)(t.h3,{id:"-option-1-tiered-weighting-\uae30\ubcf8\uac12",children:"\u2b50 Option 1: Tiered Weighting (\uae30\ubcf8\uac12)"}),"\n",(0,r.jsx)(t.p,{children:"YAML SSOT\uc5d0\uc11c \uc815\uc758\ub41c \uae30\ubcf8 \ube44\uc911 \ubc30\ubd84 \ubc29\uc2dd\uc785\ub2c8\ub2e4."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-go",children:"// tieredWeight calculates weights based on ranking tiers\n// SSOT: config/strategy/korea_equity_v13.yaml portfolio.weighting.tiers\n// \uae30\ubcf8: 1-5\uc704 5%, 6-15\uc704 4.5%, 16-20\uc704 4% (\ucd1d 90% \uc8fc\uc2dd + 10% \ud604\uae08)\nfunc (c *Constructor) tieredWeight(stocks []contracts.RankedStock) map[string]float64 {\n    weights := make(map[string]float64)\n\n    // tier \uc124\uc815\uc774 \uc5c6\uc73c\uba74 \uae30\ubcf8\uac12 \uc0ac\uc6a9\n    tiers := c.config.Tiers\n    if len(tiers) == 0 {\n        tiers = DefaultTiers()\n    }\n\n    // \uac01 tier\ubcc4\ub85c \ube44\uc911 \ud560\ub2f9\n    stockIdx := 0\n    for _, tier := range tiers {\n        for i := 0; i < tier.Count && stockIdx < len(stocks); i++ {\n            weights[stocks[stockIdx].Code] = tier.WeightEach\n            stockIdx++\n        }\n    }\n\n    return weights\n}\n\n// DefaultTiers returns default tier configuration\nfunc DefaultTiers() []TierConfig {\n    return []TierConfig{\n        {Count: 5, WeightEach: 0.05},   // 1-5\uc704: 5% \uac01\uac01\n        {Count: 10, WeightEach: 0.045}, // 6-15\uc704: 4.5% \uac01\uac01\n        {Count: 5, WeightEach: 0.04},   // 16-20\uc704: 4% \uac01\uac01\n    }\n    // \ud569: 5\xd75% + 10\xd74.5% + 5\xd74% = 25% + 45% + 20% = 90% (+ \ud604\uae08 10% = 100%)\n}\n"})}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.strong,{children:"Tier\ubcc4 \ube44\uc911 \ubc30\ubd84:"})}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"\uc21c\uc704"}),(0,r.jsx)(t.th,{children:"Tier"}),(0,r.jsx)(t.th,{children:"\uc885\ubaa9 \uc218"}),(0,r.jsx)(t.th,{children:"\uc885\ubaa9\ub2f9 \ube44\uc911"}),(0,r.jsx)(t.th,{children:"\ud569\uacc4"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"1-5\uc704"}),(0,r.jsx)(t.td,{children:"Tier 1"}),(0,r.jsx)(t.td,{children:"5\uac1c"}),(0,r.jsx)(t.td,{children:"5.0%"}),(0,r.jsx)(t.td,{children:"25%"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"6-15\uc704"}),(0,r.jsx)(t.td,{children:"Tier 2"}),(0,r.jsx)(t.td,{children:"10\uac1c"}),(0,r.jsx)(t.td,{children:"4.5%"}),(0,r.jsx)(t.td,{children:"45%"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"16-20\uc704"}),(0,r.jsx)(t.td,{children:"Tier 3"}),(0,r.jsx)(t.td,{children:"5\uac1c"}),(0,r.jsx)(t.td,{children:"4.0%"}),(0,r.jsx)(t.td,{children:"20%"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.strong,{children:"\ud569\uacc4"})}),(0,r.jsx)(t.td,{children:"-"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.strong,{children:"20\uac1c"})}),(0,r.jsx)(t.td,{children:"-"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.strong,{children:"90%"})})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"\ud604\uae08"}),(0,r.jsx)(t.td,{children:"-"}),(0,r.jsx)(t.td,{children:"-"}),(0,r.jsx)(t.td,{children:"10%"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.strong,{children:"10%"})})]})]})]}),"\n",(0,r.jsx)(t.h3,{id:"option-2-equal-weight-\ub3d9\uc77c-\ube44\uc911",children:"Option 2: Equal Weight (\ub3d9\uc77c \ube44\uc911)"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-go",children:"func (c *Constructor) equalWeight(stocks []contracts.RankedStock) map[string]float64 {\n    available := 1.0 - c.config.CashReserve\n    weight := available / float64(len(stocks))\n\n    weights := make(map[string]float64)\n    for _, stock := range stocks {\n        weights[stock.Code] = weight\n    }\n\n    return weights\n}\n"})}),"\n",(0,r.jsx)(t.h3,{id:"option-3-score-based-\uc810\uc218-\ube44\ub840",children:"Option 3: Score-Based (\uc810\uc218 \ube44\ub840)"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-go",children:"func (c *Constructor) scoreBasedWeight(stocks []contracts.RankedStock) map[string]float64 {\n    available := 1.0 - c.config.CashReserve\n\n    // Calculate total score (only positive scores)\n    var totalScore float64\n    for _, stock := range stocks {\n        // Normalize score to 0 ~ 1 (from -1 ~ 1)\n        normalizedScore := (stock.TotalScore + 1.0) / 2.0\n        if normalizedScore > 0 {\n            totalScore += normalizedScore\n        }\n    }\n\n    if totalScore == 0 {\n        // Fallback to equal weight\n        return c.equalWeight(stocks)\n    }\n\n    weights := make(map[string]float64)\n    for _, stock := range stocks {\n        normalizedScore := (stock.TotalScore + 1.0) / 2.0\n        if normalizedScore > 0 {\n            weights[stock.Code] = (normalizedScore / totalScore) * available\n        }\n    }\n\n    return weights\n}\n"})}),"\n",(0,r.jsx)(t.h3,{id:"option-4-risk-parity-\ub9ac\uc2a4\ud06c-\ud328\ub9ac\ud2f0",children:"Option 4: Risk Parity (\ub9ac\uc2a4\ud06c \ud328\ub9ac\ud2f0)"}),"\n",(0,r.jsxs)(t.blockquote,{children:["\n",(0,r.jsx)(t.p,{children:"Risk Parity\ub294 \ubcc0\ub3d9\uc131 \ub370\uc774\ud130\uac00 \ud544\uc694\ud558\ubbc0\ub85c \ud5a5\ud6c4 \uad6c\ud604 \uc608\uc815"}),"\n"]}),"\n",(0,r.jsx)(t.hr,{}),"\n",(0,r.jsx)(t.h2,{id:"\uc81c\uc57d\uc870\uac74",children:"\uc81c\uc57d\uc870\uac74"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-go",children:"// internal/portfolio/constraints.go\n\ntype Constraints struct {\n    MaxSectorWeight float64  // \uc139\ud130\ub2f9 \ucd5c\ub300 \ube44\uc911 (0.0 ~ 1.0)\n    MaxWeight       float64  // \uc885\ubaa9\ub2f9 \ucd5c\ub300 \ube44\uc911 (0.0 ~ 1.0)\n    MinWeight       float64  // \uc885\ubaa9\ub2f9 \ucd5c\uc18c \ube44\uc911 (0.0 ~ 1.0)\n    BlackList       []string // \uc81c\uc678 \uc885\ubaa9 \ub9ac\uc2a4\ud2b8\n}\n\nfunc (c *Constraints) IsBlackListed(code string) bool {\n    return slices.Contains(c.BlackList, code)\n}\n\nfunc DefaultConstraints() Constraints {\n    return Constraints{\n        MaxSectorWeight: 0.25, // \uc139\ud130\ub2f9 \ucd5c\ub300 25%\n        MaxWeight:       0.10, // \uc885\ubaa9\ub2f9 \ucd5c\ub300 10%\n        MinWeight:       0.04, // \uc885\ubaa9\ub2f9 \ucd5c\uc18c 4%\n        BlackList:       []string{},\n    }\n}\n\n// applyConstraints applies portfolio constraints to weights\nfunc (c *Constructor) applyConstraints(weights map[string]float64) map[string]float64 {\n    result := make(map[string]float64)\n\n    for code, weight := range weights {\n        // Apply max weight constraint\n        if weight > c.constraints.MaxWeight {\n            weight = c.constraints.MaxWeight\n        }\n\n        // Apply min weight constraint\n        if weight < c.constraints.MinWeight {\n            continue // \uc81c\uc678\n        }\n\n        // Check blacklist\n        if c.constraints.IsBlackListed(code) {\n            continue\n        }\n\n        result[code] = weight\n    }\n\n    // Normalize weights to sum to (1.0 - CashReserve)\n    return c.normalizeWeights(result)\n}\n\n// normalizeWeights normalizes weights to sum to target total\nfunc (c *Constructor) normalizeWeights(weights map[string]float64) map[string]float64 {\n    targetTotal := 1.0 - c.config.CashReserve\n\n    // Calculate current total\n    var currentTotal float64\n    for _, weight := range weights {\n        currentTotal += weight\n    }\n\n    if currentTotal == 0 {\n        return weights\n    }\n\n    // Scale weights\n    factor := targetTotal / currentTotal\n    normalized := make(map[string]float64)\n    for code, weight := range weights {\n        normalized[code] = weight * factor\n    }\n\n    return normalized\n}\n"})}),"\n",(0,r.jsx)(t.hr,{}),"\n",(0,r.jsx)(t.h2,{id:"portfolio-repository",children:"Portfolio Repository"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-go",children:'// internal/portfolio/repository.go\n\ntype Repository struct {\n    pool *pgxpool.Pool\n}\n\nfunc (r *Repository) SaveTargetPortfolio(ctx context.Context, target *contracts.TargetPortfolio) error {\n    tx, err := r.pool.Begin(ctx)\n    defer tx.Rollback(ctx)\n\n    // Delete existing positions for the date\n    _, err = tx.Exec(ctx, "DELETE FROM portfolio.target_positions WHERE target_date = $1", target.Date)\n\n    // Insert new positions\n    // \u2b50 P0 \uc218\uc815: target_qty \u2192 target_value (\ubaa9\ud45c \uae08\uc561)\n    query := `\n        INSERT INTO portfolio.target_positions (\n            target_date, stock_code, stock_name, weight, target_value, action, reason\n        ) VALUES ($1, $2, $3, $4, $5, $6, $7)\n    `\n\n    for _, pos := range target.Positions {\n        _, err := tx.Exec(ctx, query,\n            target.Date, pos.Code, pos.Name, pos.Weight, pos.TargetValue, pos.Action, pos.Reason,\n        )\n    }\n\n    // Save portfolio summary\n    summaryQuery := `\n        INSERT INTO portfolio.portfolio_snapshots (\n            snapshot_date, total_positions, total_weight, cash_reserve, created_at\n        ) VALUES ($1, $2, $3, $4, NOW())\n        ON CONFLICT (snapshot_date) DO UPDATE SET\n            total_positions = EXCLUDED.total_positions,\n            total_weight = EXCLUDED.total_weight,\n            cash_reserve = EXCLUDED.cash_reserve,\n            created_at = NOW()\n    `\n\n    _, err = tx.Exec(ctx, summaryQuery,\n        target.Date, len(target.Positions), target.TotalWeight(), target.Cash,\n    )\n\n    return tx.Commit(ctx)\n}\n\nfunc (r *Repository) GetTargetPortfolio(ctx context.Context, date time.Time) (*contracts.TargetPortfolio, error) {\n    // \u2b50 P0 \uc218\uc815: target_qty \u2192 target_value\n    query := `\n        SELECT stock_code, stock_name, weight, target_value, action, reason\n        FROM portfolio.target_positions\n        WHERE target_date = $1\n        ORDER BY weight DESC\n    `\n\n    rows, err := r.pool.Query(ctx, query, date)\n    defer rows.Close()\n\n    portfolio := &contracts.TargetPortfolio{\n        Date:      date,\n        Positions: make([]contracts.TargetPosition, 0),\n    }\n\n    for rows.Next() {\n        var pos contracts.TargetPosition\n        err := rows.Scan(&pos.Code, &pos.Name, &pos.Weight, &pos.TargetValue, &pos.Action, &pos.Reason)\n        portfolio.Positions = append(portfolio.Positions, pos)\n    }\n\n    return portfolio, nil\n}\n\nfunc (r *Repository) SaveHoldings(ctx context.Context, date time.Time, holdings []Holding) error {\n    // \ud604\uc7ac \ubcf4\uc720 \uc885\ubaa9 \uc800\uc7a5\n}\n\nfunc (r *Repository) GetCurrentHoldings(ctx context.Context, date time.Time) ([]Holding, error) {\n    // \ud604\uc7ac \ubcf4\uc720 \uc885\ubaa9 \uc870\ud68c\n}\n\nfunc (r *Repository) SaveRebalanceLog(ctx context.Context, log *RebalanceLog) error {\n    // \ub9ac\ubc38\ub7f0\uc2f1 \ub85c\uadf8 \uc800\uc7a5\n}\n'})}),"\n",(0,r.jsx)(t.hr,{}),"\n",(0,r.jsx)(t.h2,{id:"db-\uc2a4\ud0a4\ub9c8",children:"DB \uc2a4\ud0a4\ub9c8"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-sql",children:"-- portfolio.target_positions: \ubaa9\ud45c \ud3ec\ud2b8\ud3f4\ub9ac\uc624 \ud3ec\uc9c0\uc158\n-- \u2b50 P0 \uc218\uc815: target_qty \u2192 target_value (\ubaa9\ud45c \uae08\uc561)\n-- \uc218\ub7c9(Qty)\uc740 Execution(S6)\uc5d0\uc11c \ud604\uc7ac\uac00\ub85c \uacc4\uc0b0\nCREATE TABLE portfolio.target_positions (\n    id          SERIAL PRIMARY KEY,\n    target_date DATE NOT NULL,\n    stock_code  VARCHAR(10) NOT NULL,\n    stock_name  VARCHAR(100),\n    weight      DECIMAL(8,4),       -- \ubaa9\ud45c \ube44\uc911\n    target_value BIGINT,            -- \u2b50 \ubaa9\ud45c \uae08\uc561 (\uc6d0\ud654). \uc218\ub7c9\uc740 S6\uc5d0\uc11c \uacc4\uc0b0\n    action      VARCHAR(10),        -- BUY, SELL, HOLD\n    reason      TEXT,               -- \uc561\uc158 \uc0ac\uc720\n    created_at  TIMESTAMPTZ DEFAULT NOW(),\n    UNIQUE(target_date, stock_code)\n);\n\n-- portfolio.portfolio_snapshots: \ud3ec\ud2b8\ud3f4\ub9ac\uc624 \uc2a4\ub0c5\uc0f7\nCREATE TABLE portfolio.portfolio_snapshots (\n    id              SERIAL PRIMARY KEY,\n    snapshot_date   DATE NOT NULL UNIQUE,\n    total_positions INT,\n    total_weight    DECIMAL(8,4),\n    cash_reserve    DECIMAL(8,4),\n    created_at      TIMESTAMPTZ DEFAULT NOW()\n);\n\n-- portfolio.holdings: \ud604\uc7ac \ubcf4\uc720 \uc885\ubaa9\nCREATE TABLE portfolio.holdings (\n    id                  SERIAL PRIMARY KEY,\n    holding_date        DATE NOT NULL,\n    stock_code          VARCHAR(10) NOT NULL,\n    stock_name          VARCHAR(100),\n    quantity            INT NOT NULL,\n    avg_price           DECIMAL(12,2),\n    current_price       DECIMAL(12,2),\n    market_value        DECIMAL(15,2),\n    weight              DECIMAL(8,4),\n    unrealized_pnl      DECIMAL(15,2),\n    unrealized_pnl_pct  DECIMAL(8,4),\n    created_at          TIMESTAMPTZ DEFAULT NOW(),\n    UNIQUE(holding_date, stock_code)\n);\n\n-- portfolio.rebalance_logs: \ub9ac\ubc38\ub7f0\uc2f1 \ub85c\uadf8\nCREATE TABLE portfolio.rebalance_logs (\n    id                SERIAL PRIMARY KEY,\n    rebalance_date    DATE NOT NULL,\n    total_orders      INT,\n    executed_orders   INT,\n    failed_orders     INT,\n    turnover          DECIMAL(8,4),     -- \ud68c\uc804\uc728\n    execution_time_ms BIGINT,\n    metadata          JSONB,\n    created_at        TIMESTAMPTZ DEFAULT NOW()\n);\n\nCREATE INDEX idx_target_positions_date ON portfolio.target_positions(target_date);\nCREATE INDEX idx_holdings_date ON portfolio.holdings(holding_date, stock_code);\nCREATE INDEX idx_rebalance_logs_date ON portfolio.rebalance_logs(rebalance_date);\n"})}),"\n",(0,r.jsx)(t.hr,{}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"Prev"}),": ",(0,r.jsx)(t.a,{href:"/aegis-v13/docs/guide/backend/selection-layer",children:"Selection Layer"}),"\n",(0,r.jsx)(t.strong,{children:"Next"}),": ",(0,r.jsx)(t.a,{href:"/aegis-v13/docs/guide/backend/execution-layer",children:"Execution Layer"})]})]})}function h(n={}){const{wrapper:t}={...(0,i.R)(),...n.components};return t?(0,r.jsx)(t,{...n,children:(0,r.jsx)(d,{...n})}):d(n)}},8453(n,t,e){e.d(t,{R:()=>s,x:()=>a});var o=e(6540);const r={},i=o.createContext(r);function s(n){const t=o.useContext(i);return o.useMemo(function(){return"function"==typeof n?n(t):{...t,...n}},[t,n])}function a(n){let t;return t=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:s(n.components),o.createElement(i.Provider,{value:t},n.children)}}}]);